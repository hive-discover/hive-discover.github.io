var j$=jQuery,$mContainer=j$("#mnsry_container"),$filterButton=j$(".button"),$loadingMessage=j$("#loading_msg");$params={itemSelector:".item",filtersGroupSelector:".filters"},j$(window).load((function(){$mContainer.multipleFilterMasonry($params),$mContainer.find("article").animate({opacity:1},1200),$loadingMessage.fadeOut(),$filterButton.find("input").change((function(){j$(this).parent().toggleClass("active")}))}));let open_accounts=[];function SetAccountCard(e){hivejs.api.getAccounts([e],(function(t,n){if(n&&n.length>0){const t=n[0];if(t.json_metadata){const n=JSON.parse(t.json_metadata);if(n.profile){const t={NAME:n.profile.name,DESCRIPTION:n.profile.about,LOCATION:n.profile.location,AUTHOR:e},s=Handlebars.compile(document.getElementById("author-card-holder").innerHTML),r=document.createElement("div");if(r.innerHTML=s(t),item_count+=1,row_heights[0]<row_heights[1]&&row_heights[0]<row_heights[2])document.getElementById("card-row-1").appendChild(r),row_heights[0]+=parseInt(r.offsetHeight);else if(row_heights[1]<row_heights[0]&&row_heights[1]<row_heights[2])document.getElementById("card-row-2").appendChild(r),row_heights[1]+=parseInt(r.offsetHeight);else if(row_heights[3]<row_heights[0]&&row_heights[3]<row_heights[2])document.getElementById("card-row-3").appendChild(r),row_heights[2]+=parseInt(r.offsetHeight);else switch((item_count-1)%3){case 0:document.getElementById("card-row-1").appendChild(r),row_heights[0]+=parseInt(r.offsetHeight);break;case 1:document.getElementById("card-row-2").appendChild(r),row_heights[1]+=parseInt(r.offsetHeight);break;case 2:document.getElementById("card-row-3").appendChild(r),row_heights[2]+=parseInt(r.offsetHeight)}if(hivejs.api.getFollowCount(e,(function(e,t){if(t){var n=r.querySelectorAll('*[name="follower-count"]');n.forEach((function(e){e.innerHTML=t.follower_count})),(n=r.querySelectorAll('*[name="following-count"]')).forEach((function(e){e.innerHTML=t.following_count}))}})),n.profile.profile_image){var o=new Image;o.src=n.profile.profile_image,o.onload=function(){r.querySelectorAll('*[name="profile-image"]').forEach((function(e){e.src=o.src}))}}if(n.profile.cover_image){var a=new Image;a.src=n.profile.cover_image,a.onload=function(){r.querySelectorAll('*[name="cover-image"]').forEach((function(e){e.src=a.src}))}}}}}}))}function loadAllAccounts(){if(0==open_accounts.length)return document.getElementById("accounts-end").style.display="block",void(document.getElementById("loading-animator").style.display="none");account=open_accounts.shift(),SetAccountCard(account),setTimeout(()=>{loadAllAccounts()},100)}function getApiAccountSearchData(e=!1){let t="&mode=username";$("#cond_used").is(":checked")&&(t="&mode=bio"),$.ajax({url:API_ADDRESS+"/search-account?q="+query+t,contentType:"application/json;charset=UTF-8",type:"GET",success:function(t){if("ok"==t.status){document.getElementById("loading-animator").style.display="block";for(var n=0;n<t.accounts.length;n++)open_accounts.push(t.accounts[n]);if(0==open_accounts.length)return document.getElementById("accounts-end").style.display="block",void(document.getElementById("loading-animator").style.display="none");e&&loadAllAccounts()}},error:function(e){console.log(e)}})}function resetViewToLoadingAccounts(){open_accounts=[],document.getElementById("card-row-1").innerHTML="",document.getElementById("card-row-2").innerHTML="",document.getElementById("card-row-3").innerHTML="",document.getElementById("search-introduction").style.display="none",document.getElementById("accounts-end").style.display="none",document.getElementById("loading-animator").style.display="block",row_heights=[0,0,0],item_count=0}function SearchAccounts(){query=$("#search-input").val(),""!=query&&" "!=query&&(resetViewToLoadingAccounts(),getApiAccountSearchData(start_setting=!0))}$().ready((function(){document.getElementById("cards-exists-account")&&(null!=urlParams.get("mode")&&"bio"==urlParams.get("mode").toLowerCase()?($("#cond_new").prop("checked",!1),$("#cond_used").prop("checked",!0)):($("#cond_used").prop("checked",!1),$("#cond_new").prop("checked",!0)),urlParams.get("q")&&document.getElementById("search-input")&&($("#search-input").val(urlParams.get("q")),SearchAccounts()))}));let logged_in=!1,checked_logging_state=!1,client=null,username="",access_token="";function LoginViaHiveSigner(){0==logged_in&&client.login({})}function Logout(){client.revokeToken((function(e,t){deleteAllCookies(),window.location.replace("/")}))}function setCategoriesChart(e,t){if(0!=CHARTS_READY){for(var n=[["Topic","Value"]],o=0;o<t.length;o++)t[o].value>.05&&n.push([t[o].label,t[o].value]);new google.visualization.PieChart(document.getElementById(e)).draw(google.visualization.arrayToDataTable(n),{backgroundColor:"transparent",title:"Our AI thinks that these topics might fit to you:",enableInteractivity:!1,height:600,pieHole:.1})}else setTimeout((function(){setCategoriesChart(e,t)}),250)}function getAccountAPIData(){$.ajax({url:API_ADDRESS+"/get-account?username="+username+"&access_token="+access_token,contentType:"application/json;charset=UTF-8",type:"GET",success:function(e){if("ok"==e.status)if(setCategoriesChart("chart-account-categories",e.categories),console.log(e),document.getElementById("account-progress-bar-container")&&e.loading){const t=Math.round(e.loading.current/e.loading.max*100);let n=document.createElement("div");n.classList.add("progress-bar"),n.classList.add("progress-bar-striped"),n.setAttribute("aria-valuenow",t),n.setAttribute("aria-valuemin",0),n.setAttribute("aria-valuemin",100),n.style.width=t+"%",n.innerText=t+"%";let o=document.createElement("div");o.classList.add("progress"),o.appendChild(n),document.getElementById("account-progress-bar-container").innerHTML="",document.getElementById("account-progress-bar-container").appendChild(o),document.getElementById("account-progress-bar-container").style.display="block",setTimeout(getAccountAPIData,2e3)}else document.getElementById("account-progress-bar-container").style.display="none";else e.banned&&(alert("You are banned"),deleteAllCookies(!0),window.location.replace("/index.html"));document.getElementById("loading-animator").style.display="none"},error:function(e){console.log(e)}})}function pingAPI(){}$().ready((function(){if(client=new hivesigner.Client({app:"action-chain",callbackURL:"http://127.0.0.1:8000/me/login.html",scope:["login"]}),urlParams.get("access_token")&&urlParams.get("expires_in")&&urlParams.get("username"))return client.setAccessToken([urlParams.get("access_token")]),void client.me((function(e,t){t?(setCookie("access_token",urlParams.get("access_token"),urlParams.get("expires_in")/60/24),setCookie("username",urlParams.get("username"),urlParams.get("expires_in")/60/24),window.location.replace("/me/account.html")):alert("Something went wrong")}));checkCookie("username")&&checkCookie("access_token")?(logged_in=!0,username=getCookie("username"),access_token=getCookie("access_token"),client.setAccessToken([access_token]),window.location.href.indexOf("explore.html")>-1&&window.location.replace("/me/feed.html"),client.me((function(e,t){t?(console.log(t),pingAPI(),window.location.href.indexOf("/me/account.html")>-1&&getAccountAPIData(),window.location.href.indexOf("/me/feed.html")>-1&&(post_cards_mode="feed",getFeedAPIData(start_setting=!0))):(alert("Wrong access token"),Logout()),checked_logging_state=!0})),document.getElementById("label-welcome-username")&&(document.getElementById("label-welcome-username").innerText="Welcome, "+username),document.getElementsByName("label-with-username").forEach((function(e){e.innerHTML="@"+username})),document.getElementById("setting-ban-account")&&(document.getElementById("setting-ban-account").style.display="block"),document.getElementById("setting-delete-account")&&(document.getElementById("setting-delete-account").style.display="block"),document.getElementById("navbar-account")&&(document.getElementById("navbar-account").style.display="block"),document.getElementById("navbar-login")&&(document.getElementById("navbar-login").style.display="none")):(checked_logging_state=!0,document.getElementById("need-login")&&window.location.replace("/explore.html")),window.location.href.indexOf("logout.html")>-1&&Logout()}));const urlParams=new URLSearchParams(window.location.search),API_ADDRESS="http://192.168.178.20:8888/";let CHARTS_READY=!1;function openHiveSite(e){var t="https://peakd.com";checkCookie("settings-front-end")&&(t=getCookie("front-end")),window.open(t+e,"_blank").focus()}function OnSearchBarGo(){let e=$("#search-field").val();window.location.href="/search-posts.html?q="+e}function makeid(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,a=0;a<e;a++)t+=n.charAt(Math.floor(Math.random()*o));return t}function setCookie(e,t,n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);var a="expires="+o.toUTCString();document.cookie=e+"="+t+";"+a+";path=/"}function getCookie(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),o=0;o<n.length;o++){for(var a=n[o];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""}function checkCookie(e){return""!=getCookie(e)}function deleteAllCookies(e=!1){for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var o=t[n];if(!(o.indexOf("settings-")>-1&&0==e)){var a=o.indexOf("="),s=a>-1?o.substr(0,a):o;document.cookie=s+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"}}}$().ready((function(){google.charts.load("current",{packages:["corechart","line"]}),google.charts.setOnLoadCallback((function(){CHARTS_READY=!0}))}));let item_count=0,open_posts=[],query="",post_cards_mode="",settings_posts=!1,row_heights=[0,0,0];function setCardWithPost(e,t){hivejs.api.getContent(e,t,(function(e,t){if(t){var n=JSON.parse(t.json_metadata),o=(n.tags,document.createElement("div"));o.innerHTML=t.body;var a=o.innerText;a=(a=(a=(a=a.replace(/[\(\[].*?[\)\]]/,"")).replace(/(?:https?|ftp):\/\/[\n\S]+/g,"")).replace(/(?:http?|ftp):\/\/[\n\S]+/g,"")).replace("!(","");var s=[];"image"in n&&(s=n.image);for(var r=0;r<o.getElementsByTagName("img").length;r++)s.push(o.getElementsByTagName("img")[r].src);var i={AUTHOR:t.author,TITLE:t.title,BODY:a,POST_URL:t.url};let e=Handlebars.compile(document.getElementById("card-holder-3").innerHTML),l=document.createElement("div");if(l.innerHTML=e(i),item_count+=1,row_heights[0]<row_heights[1]&&row_heights[0]<row_heights[2])document.getElementById("card-row-1").appendChild(l),row_heights[0]+=parseInt(l.offsetHeight);else if(row_heights[1]<row_heights[0]&&row_heights[1]<row_heights[2])document.getElementById("card-row-2").appendChild(l),row_heights[1]+=parseInt(l.offsetHeight);else if(row_heights[3]<row_heights[0]&&row_heights[3]<row_heights[2])document.getElementById("card-row-3").appendChild(l),row_heights[2]+=parseInt(l.offsetHeight);else switch((item_count-1)%3){case 0:document.getElementById("card-row-1").appendChild(l),row_heights[0]+=parseInt(l.offsetHeight);break;case 1:document.getElementById("card-row-2").appendChild(l),row_heights[1]+=parseInt(l.offsetHeight);break;case 2:document.getElementById("card-row-3").appendChild(l),row_heights[2]+=parseInt(l.offsetHeight)}if(s.length>0){var c=new Image;c.src=s[0],c.onload=function(){l.querySelectorAll('*[name="card-image"]').forEach((function(e){"img"==e.tagName.toLowerCase()&&(e.src=c.src),"div"==e.tagName.toLowerCase()&&(e.style.background="url('"+c.src+"')")})),item_count+=1}}}}))}function loadSomePosts(e=1e4,t=!1){e<=0?settings_posts=!1:0==t&1==settings_posts||(settings_posts=!0,0==open_posts.length&&(document.getElementById("loading-animator").style.display="none"),post=open_posts.shift(),post&&setCardWithPost(post.a,post.p),setTimeout((function(){loadSomePosts(e-=1,t=!0)}),500))}function getApiSearchData(e=!1){$.ajax({url:API_ADDRESS+"/search-post?q="+query,contentType:"application/json;charset=UTF-8",type:"GET",success:function(t){if("ok"==t.status){document.getElementById("loading-animator").style.display="block";for(var n=0;n<t.posts.length;n++)open_posts.push(t.posts[n]);if(0==open_posts.length)return document.getElementById("posts-end").style.display="block",void(document.getElementById("loading-animator").style.display="none");e&&loadSomePosts()}},error:function(e){console.log(e)}})}function getFeedAPIData(e=!1){null!=access_token?$.ajax({url:API_ADDRESS+"/get-feed?username="+username+"&access_token="+access_token,contentType:"application/json;charset=UTF-8",type:"GET",success:function(t){document.getElementById("loading-animator").style.display="block";for(var n=0;n<t.posts.length;n++)open_posts.push(t.posts[n]);0!=open_posts.length?e&&loadSomePosts():setTimeout(()=>{getFeedAPIData(e=e)},200)},error:function(e){console.log(e)}}):setTimeout((function(){getFeedAPIData(e=e)}),250)}function resetViewToLoading(){open_posts=[],document.getElementById("card-row-1").innerHTML="",document.getElementById("card-row-2").innerHTML="",document.getElementById("card-row-3").innerHTML="",document.getElementById("posts-introduction").style.display="none",document.getElementById("posts-end").style.display="none",document.getElementById("loading-animator").style.display="block",row_heights=[0,0,0],item_count=0}function SearchPosts(){query=$("#search-input").val(),""!=query&&" "!=query&&(resetViewToLoading(),post_cards_mode="search",getApiSearchData(start_setting=!0))}function OnChangeFronEnd(e){$("#settings-front-end-url").val(e),setCookie("settings-front-end",e,1780)}function setSettings(){checkCookie("settings-front-end")&&$("#settings-front-end-url").val(getCookie("settings-front-end"))}function OnClickDeleteMeSure(){$.ajax({url:API_ADDRESS+"/delete-account?username="+username+"&access_token="+access_token,contentType:"application/json;charset=UTF-8",type:"GET",success:function(e){"ok"==e.status?(deleteAllCookies(also_settings=!0),Logout()):alert("Something went wrong. Your account is not deleted. Please inform the Owner of Hive-Discover")},error:function(e){alert("Something went wrong. Your account is not deleted. Please inform the Owner of Hive-Discover")}})}function OnClickBanMeSure(){$.ajax({url:API_ADDRESS+"/ban-account?username="+username+"&access_token="+access_token,contentType:"application/json;charset=UTF-8",type:"GET",success:function(e){"ok"==e.status?(deleteAllCookies(also_settings=!0),Logout()):alert("Something went wrong. Your account is not banned. Please inform the Owner of Hive-Discover")},error:function(e){alert("Something went wrong. Your account is not banned. Please inform the Owner of Hive-Discover")}})}$().ready((function(){document.getElementById("cards-exists")&&urlParams.get("q")&&document.getElementById("search-input")&&($("#search-input").val(urlParams.get("q")),SearchPosts())})),$().ready((function(){window.location.href.indexOf("/me/settings.html")&&setSettings()}));let stat_data=null;function doAuthorQueriesChart(e){if(null!=stat_data)if(0!=CHARTS_READY){var t=new google.visualization.DataTable;t.addColumn("number","Hour"),t.addColumn("number","");for(var n=0;n<stat_data.data.length;n++)t.addRow([n,stat_data.data[n].author_queries]);new google.charts.Line(document.getElementById("stats-chart-account-queries")).draw(t,google.charts.Line.convertOptions({chart:{title:"Account_queries per Hour",height:150}})),setTimeout(e,250)}else setTimeout(doRequestConnectionsChart,250)}function doPostQueriesChart(e){if(null!=stat_data)if(0!=CHARTS_READY){var t=new google.visualization.DataTable;t.addColumn("number","Hour"),t.addColumn("number","");for(var n=0;n<stat_data.data.length;n++)t.addRow([n,stat_data.data[n].post_queries]);new google.charts.Line(document.getElementById("stats-chart-post-queries")).draw(t,google.charts.Line.convertOptions({chart:{title:"Post_queries per Hour",height:150}})),setTimeout(e,250)}else setTimeout(doRequestConnectionsChart,250)}function doFeedQueriesChart(e){if(null!=stat_data)if(0!=CHARTS_READY){var t=new google.visualization.DataTable;t.addColumn("number","Hour"),t.addColumn("number","");for(var n=0;n<stat_data.data.length;n++)t.addRow([n,stat_data.data[n].feed_requested]);new google.charts.Line(document.getElementById("stats-chart-feed-requests")).draw(t,google.charts.Line.convertOptions({chart:{title:"Feed requests per Hour",height:150}})),setTimeout(e,250)}else setTimeout(doRequestConnectionsChart,250)}function doRequestTypesChart(e){if(null!=stat_data)if(0!=CHARTS_READY){for(var t=[["author_queries",0],["post_queries",0],["feed_requests",0]],n=0;n<stat_data.data.length;n++)t[0][1]=t[0][1]+stat_data.data[n].author_queries,t[1][1]=t[1][1]+stat_data.data[n].post_queries,t[2][1]=t[2][1]+stat_data.data[n].feed_requested;var o=[["Topic","Value"]];t.forEach((function(e){o.push(e)}));new google.visualization.PieChart(document.getElementById("stats-chart-types")).draw(google.visualization.arrayToDataTable(o),{backgroundColor:"transparent",title:"Request Types:",enableInteractivity:!1,height:500,pieHole:.1}),setTimeout(e,250)}else setTimeout(doRequestTypesChart,250)}function doRequestConnectionsChart(e){if(null!=stat_data)if(0!=CHARTS_READY){var t=new google.visualization.DataTable;t.addColumn("number","Hour"),t.addColumn("number","Connections"),t.addColumn("number","Requests");for(var n=0;n<stat_data.data.length;n++)t.addRow([n,stat_data.data[n].connections,stat_data.data[n].requests]);new google.charts.Line(document.getElementById("stats-chart-request-connections")).draw(t,google.charts.Line.convertOptions({chart:{title:"Requests and Connections per Hour",subtitle:"(collected anonym)",height:500}})),setTimeout(e,250)}else setTimeout(doRequestConnectionsChart,250)}function GetStats(e=null){let t="";e&&(t="?date="+e),$.ajax({url:API_ADDRESS+"/get-stats"+t,contentType:"application/json;charset=UTF-8",type:"GET",success:function(e){"ok"==e.status&&(stat_data=e,doRequestConnectionsChart(doFeedQueriesChart(doPostQueriesChart(doAuthorQueriesChart(doRequestTypesChart())))))},error:function(e){console.log(e)}})}$().ready((function(){location.href.indexOf("stats.html")>-1&&GetStats()}));