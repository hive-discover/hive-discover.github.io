var j$=jQuery,$mContainer=j$("#mnsry_container"),$filterButton=j$(".button"),$loadingMessage=j$("#loading_msg");$params={itemSelector:".item",filtersGroupSelector:".filters"},j$(window).load((function(){$mContainer.multipleFilterMasonry($params),$mContainer.find("article").animate({opacity:1},1200),$loadingMessage.fadeOut(),$filterButton.find("input").change((function(){j$(this).parent().toggleClass("active")}))}));let open_accounts=[];function SetCoverProfileImage(e,t){if(e.profile){if(e.profile.profile_image){var n=new Image;n.src=e.profile.profile_image,n.onload=function(){t.querySelectorAll('*[name="profile-image"]').forEach((function(e){e.src=n.src}))}}if(e.profile.cover_image){var o=new Image;o.src=e.profile.cover_image,o.onload=function(){t.querySelectorAll('*[name="cover-image"]').forEach((function(e){e.src=o.src}))}}}}function SetFollowingAPI(e,t){hivejs.api.getFollowCount(e,(function(e,n){if(n){var o=t.querySelectorAll('*[name="follower-count"]');o.forEach((function(e){e.innerHTML=n.follower_count})),(o=t.querySelectorAll('*[name="following-count"]')).forEach((function(e){e.innerHTML=n.following_count}))}}))}function SetAccountCards(e=9){let t=[];for(;open_accounts.length>0&&t.length<e;)t.push(open_accounts.shift());0!=t.length&&hivejs.api.getAccounts(t,(function(e,t){if(t)for(let e=0;e<t.length;e++){const n=t[e];if(n.json_metadata){const e=JSON.parse(n.json_metadata);let t={NAME:"",DESCRIPTION:"",LOCATION:"",AUTHOR:n.name};e.profile&&(t.NAME=e.profile.name,t.DESCRIPTION=e.profile.about,t.LOCATION=e.profile.location,t.AUTHOR=n.name);const o=Handlebars.compile(document.getElementById("author-card-holder").innerHTML),a=document.createElement("div");if(a.innerHTML=o(t),item_count+=1,row_heights[0]<row_heights[1]&&row_heights[0]<row_heights[2])document.getElementById("card-row-1").appendChild(a),row_heights[0]+=parseInt(a.offsetHeight);else if(row_heights[1]<row_heights[0]&&row_heights[1]<row_heights[2])document.getElementById("card-row-2").appendChild(a),row_heights[1]+=parseInt(a.offsetHeight);else if(row_heights[3]<row_heights[0]&&row_heights[3]<row_heights[2])document.getElementById("card-row-3").appendChild(a),row_heights[2]+=parseInt(a.offsetHeight);else switch((item_count-1)%3){case 0:document.getElementById("card-row-1").appendChild(a),row_heights[0]+=parseInt(a.offsetHeight);break;case 1:document.getElementById("card-row-2").appendChild(a),row_heights[1]+=parseInt(a.offsetHeight);break;case 2:document.getElementById("card-row-3").appendChild(a),row_heights[2]+=parseInt(a.offsetHeight)}SetFollowingAPI(n.name,a),SetCoverProfileImage(e,a)}}loadAllAccounts()}))}function loadAllAccounts(){if(0==open_accounts.length)return document.getElementById("accounts-end").style.display="block",void(document.getElementById("loading-animator").style.display="none");SetAccountCards()}function getApiAccountSearchData(e=!1){let t="username";$("#cond_used").is(":checked")&&(t="profile_information"),$.ajax({url:API_ADDRESS+"search/accounts",data:JSON.stringify({query:query,mode:t,max:50}),contentType:"application/json;charset=UTF-8",method:"POST",success:function(t){if("ok"==t.status){document.getElementById("loading-animator").style.display="block";for(var n=0;n<t.accounts.length;n++)open_accounts.push(t.accounts[n]);if(0==open_accounts.length)return document.getElementById("accounts-end").style.display="block",void(document.getElementById("loading-animator").style.display="none");e&&loadAllAccounts()}},error:function(e){console.log(e)}})}function resetViewToLoadingAccounts(){open_accounts=[],document.getElementById("card-row-1").innerHTML="",document.getElementById("card-row-2").innerHTML="",document.getElementById("card-row-3").innerHTML="",document.getElementById("search-introduction").style.display="none",document.getElementById("accounts-end").style.display="none",document.getElementById("loading-animator").style.display="block",row_heights=[0,0,0],item_count=0}function SearchAccounts(){query=$("#search-input").val(),""!=query&&" "!=query&&(resetViewToLoadingAccounts(),getApiAccountSearchData(start_setting=!0))}$().ready((function(){document.getElementById("cards-exists-account")&&(null!=urlParams.get("mode")&&"bio"==urlParams.get("mode").toLowerCase()?($("#cond_new").prop("checked",!1),$("#cond_used").prop("checked",!0)):($("#cond_used").prop("checked",!1),$("#cond_new").prop("checked",!0)),urlParams.get("q")&&document.getElementById("search-input")&&($("#search-input").val(urlParams.get("q")),SearchAccounts()))}));let logged_in=!1,checked_logging_state=!1,client=null,username="",access_token="";function LoginViaHiveSigner(){0==logged_in&&client.login({})}function Logout(){client.revokeToken((function(e,t){deleteAllCookies(),window.location.replace("/")}))}function setCategoriesChart(e,t){if(0!=CHARTS_READY){for(var n=[["Topic","Value"]],o=0;o<t.length;o++)t[o].value>.05&&n.push([t[o].label,t[o].value]);new google.visualization.PieChart(document.getElementById(e)).draw(google.visualization.arrayToDataTable(n),{backgroundColor:"transparent",title:"Our AI thinks that these topics might fit to you:",enableInteractivity:!1,height:600,pieHole:.1})}else setTimeout((function(){setCategoriesChart(e,t)}),250)}function SetLanguages(e){if(e){let t="";e.forEach(e=>{t+=e.label+", "}),document.getElementById("account-languages").innerText="Your language(s): "+t.substring(0,t.length-2)}}function getAccountAPIData(){$.ajax({url:API_ADDRESS+"accounts/?username="+username+"&access_token="+access_token,contentType:"application/json;charset=UTF-8",type:"GET",success:function(e){document.getElementById("loading-animator").style.display="none","ok"==e.status?(setCategoriesChart("chart-account-categories",e.categories),SetLanguages(e.language),console.log(e),document.getElementById("account-loading-container")&&e.loading?document.getElementById("account-loading-container").style.display="":document.getElementById("account-loading-container").style.display="none",(0==e.categories.length||e.loading)&&setTimeout(getAccountAPIData,2500),0==e.categories.length&&(document.getElementById("loading-animator").style.display="")):e.banned&&(alert("You are banned"),deleteAllCookies(!0),window.location.replace("/index.html"))},error:function(e){console.log(e)}})}function pingAPI(){}$().ready((function(){if(client=new hivesigner.Client({app:"action-chain",callbackURL:"http://"+window.location.host+"/me/login.html",scope:["login"]}),urlParams.get("access_token")&&urlParams.get("expires_in")&&urlParams.get("username"))return client.setAccessToken([urlParams.get("access_token")]),void client.me((function(e,t){t?(username=urlParams.get("username"),access_token=urlParams.get("access_token"),setCookie("access_token",access_token,urlParams.get("expires_in")/60/24),setCookie("username",username,urlParams.get("expires_in")/60/24),getFeedAPIData(start_setting=!1,callback=function(){window.location.replace("/me/account.html")})):alert("Something went wrong")}));checkCookie("username")&&checkCookie("access_token")?(logged_in=!0,username=getCookie("username"),access_token=getCookie("access_token"),client.setAccessToken([access_token]),window.location.href.indexOf("explore.html")>-1&&window.location.replace("/me/feed.html"),client.me((function(e,t){t?(console.log(t),pingAPI(),window.location.href.indexOf("/me/account.html")>-1&&getAccountAPIData(),window.location.href.indexOf("/me/feed.html")>-1&&(post_cards_mode="feed",getFeedAPIData(start_setting=!0))):(alert("Wrong access token"),Logout()),checked_logging_state=!0})),document.getElementById("label-welcome-username")&&(document.getElementById("label-welcome-username").innerText="Welcome, "+username),document.getElementsByName("label-with-username").forEach((function(e){e.innerHTML="@"+username})),document.getElementById("setting-ban-account")&&(document.getElementById("setting-ban-account").style.display="block"),document.getElementById("setting-delete-account")&&(document.getElementById("setting-delete-account").style.display="block"),document.getElementById("navbar-account")&&(document.getElementById("navbar-account").style.display="block"),document.getElementById("navbar-login")&&(document.getElementById("navbar-login").style.display="none")):(checked_logging_state=!0,document.getElementById("need-login")&&window.location.replace("/explore.html")),window.location.href.indexOf("logout.html")>-1&&Logout()}));const urlParams=new URLSearchParams(window.location.search),API_ADDRESS="https://api.hive-discover.tech/";let CHARTS_READY=!1;function openHiveSite(e){var t="https://peakd.com";checkCookie("settings-front-end")&&(t=getCookie("settings-front-end")),window.open(t+e,"_blank").focus()}function OnSearchBarGo(){let e=$("#search-field").val();window.location.href="/search-posts.html?q="+e}function makeid(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,a=0;a<e;a++)t+=n.charAt(Math.floor(Math.random()*o));return t}function nFormatter(e,t){var n,o=[{value:1,symbol:""},{value:1e3,symbol:"k"},{value:1e6,symbol:"M"},{value:1e9,symbol:"G"},{value:1e12,symbol:"T"},{value:1e15,symbol:"P"},{value:1e18,symbol:"E"}];for(n=o.length-1;n>0&&!(e>=o[n].value);n--);return(e/o[n].value).toFixed(t).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")+o[n].symbol}function setTextValue(e,t,n){$("#"+e).val(t),n()}function setCookie(e,t,n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);var a="expires="+o.toUTCString();document.cookie=e+"="+t+";"+a+";path=/"}function getCookie(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),o=0;o<n.length;o++){for(var a=n[o];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""}function checkCookie(e){return""!=getCookie(e)}function deleteAllCookies(e=!1){for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var o=t[n];if(!(o.indexOf("settings-")>-1&&0==e)){var a=o.indexOf("="),s=a>-1?o.substr(0,a):o;document.cookie=s+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"}}}$().ready((function(){google.charts.load("current",{packages:["corechart","line"]}),google.charts.setOnLoadCallback((function(){CHARTS_READY=!0}))}));let item_count=0,open_posts=[],all_langs=[],query="",post_cards_mode="",settings_posts=!1,row_heights=[0,0,0];function setCardWithPost(e,t,n=null){hivejs.api.getContent(e,t,(function(e,t){if(n&&setTimeout(()=>{n()},150),t){var o=JSON.parse(t.json_metadata),a=o.tags;const e=marked(t.body);var s=document.createElement("div");s.innerHTML=e;var r=s.innerText;r=(r=(r=(r=r.replace(/[\(\[].*?[\)\]]/,"")).replace(/(?:https?|ftp):\/\/[\n\S]+/g,"")).replace(/(?:http?|ftp):\/\/[\n\S]+/g,"")).replace("!(","");var c=[];"image"in o&&(c=o.image);for(var i=0;i<s.getElementsByTagName("img").length;i++)c.push(s.getElementsByTagName("img")[i].src);a?(a=a.toString()).length>40&&(a=a.slice(0,40)+"..."):a="";var l={AUTHOR:t.author,TITLE:t.title,BODY:r,POST_URL:t.url,TAGS:a};let n=Handlebars.compile(document.getElementById("card-holder-3").innerHTML),d=document.createElement("div");if(d.innerHTML=n(l),item_count+=1,row_heights[0]<row_heights[1]&&row_heights[0]<row_heights[2])document.getElementById("card-row-1").appendChild(d),row_heights[0]+=parseInt(d.offsetHeight);else if(row_heights[1]<row_heights[0]&&row_heights[1]<row_heights[2])document.getElementById("card-row-2").appendChild(d),row_heights[1]+=parseInt(d.offsetHeight);else if(row_heights[3]<row_heights[0]&&row_heights[3]<row_heights[2])document.getElementById("card-row-3").appendChild(d),row_heights[2]+=parseInt(d.offsetHeight);else switch((item_count-1)%3){case 0:document.getElementById("card-row-1").appendChild(d),row_heights[0]+=parseInt(d.offsetHeight);break;case 1:document.getElementById("card-row-2").appendChild(d),row_heights[1]+=parseInt(d.offsetHeight);break;case 2:document.getElementById("card-row-3").appendChild(d),row_heights[2]+=parseInt(d.offsetHeight)}if(c.length>0){var u=new Image;u.src=c[0],u.onload=function(){d.querySelectorAll('*[name="card-image"]').forEach((function(e){"img"==e.tagName.toLowerCase()&&(e.src=u.src),"div"==e.tagName.toLowerCase()&&(e.style.background="url('"+u.src+"')")})),item_count+=1}}}}))}function loadSomePosts(e=1e4,t=!1){e<=0?settings_posts=!1:0==t&1==settings_posts||(settings_posts=!0,0==open_posts.length&&(document.getElementById("loading-animator").style.display="none",document.getElementById("account-feed-end")&&(document.getElementById("account-feed-end").style.display="")),post=open_posts.shift(),post&&setCardWithPost(post.author,post.permlink,callback=loadSomePosts(e-=1,t=!0)))}function getApiSearchData(e=!1){let t=[];$("#search-select-language").val().length>=2&&t.push($("#search-select-language").val()),$.ajax({url:API_ADDRESS+"search/posts",contentType:"application/json;charset=UTF-8",data:JSON.stringify({query:query,lang:t,max:50}),method:"POST",success:function(t){if("ok"==t.status){document.getElementById("loading-animator").style.display="block";for(var n=0;n<t.posts.length;n++)open_posts.push(t.posts[n]),t.posts[n].lang&&t.posts[n].lang.forEach(e=>{-1==all_langs.indexOf(e)&&all_langs.push(e)}),document.getElementById("label-search-results")&&(document.getElementById("label-search-results").innerText="",t.amount&&(document.getElementById("label-search-results").innerText+="Found ~"+nFormatter(t.amount,2)),t.total&&(document.getElementById("label-search-results").innerText+=" from "+nFormatter(t.total,2)+" documents"),t.seconds&&(document.getElementById("label-search-results").innerText+=" in "+nFormatter(t.seconds,3)+"s"));if(all_langs.length>0){document.getElementById("search-settings").style.display="";let e=document.createElement("a");e.className="dropdown-item",e.innerText="Clear",e.href="javascript: setTextValue('search-select-language', '', SearchPosts)",document.getElementById("search-select-language-items").appendChild(e),all_langs.forEach(t=>{e=document.createElement("a"),e.className="dropdown-item",e.innerText=t,e.href="javascript: setTextValue('search-select-language', '"+t+"', SearchPosts)",document.getElementById("search-select-language-items").appendChild(e)})}if(0==open_posts.length)return document.getElementById("posts-end").style.display="block",void(document.getElementById("loading-animator").style.display="none");e&&loadSomePosts()}},error:function(e){console.log(e)}})}function getFeedAPIData(e=!1,t=null){null!=access_token?$.ajax({url:API_ADDRESS+"accounts/feed?max=25&username="+username+"&access_token="+access_token,contentType:"application/json;charset=UTF-8",type:"GET",success:function(n){document.getElementById("loading-animator")&&(document.getElementById("loading-animator").style.display="block");for(var o=0;o<n.posts.length;o++)open_posts.push(n.posts[o]);0!=open_posts.length||1!=e?(e&&loadSomePosts(),t&&t()):setTimeout(()=>{getFeedAPIData(e=e)},750)},error:function(e){console.log(e),t&&t()}}):setTimeout((function(){getFeedAPIData(e=e)}),250)}function resetViewToLoading(){open_posts=[],document.getElementById("card-row-1").innerHTML="",document.getElementById("card-row-2").innerHTML="",document.getElementById("card-row-3").innerHTML="",document.getElementById("posts-introduction").style.display="none",document.getElementById("posts-end").style.display="none",document.getElementById("loading-animator").style.display="block",document.getElementById("account-feed-end")&&(document.getElementById("account-feed-end").style.display="none"),document.getElementById("label-search-results")&&(document.getElementById("label-search-results").innerText=""),document.getElementById("search-settings").style.display="none",document.getElementById("search-select-language-items").innerHTML="",settings_posts=!1,row_heights=[0,0,0],item_count=0}function SearchPosts(){query=$("#search-input").val(),""!=query&&" "!=query&&(resetViewToLoading(),post_cards_mode="search",getApiSearchData(start_setting=!0))}function OnChangeFronEnd(e){$("#settings-front-end-url").val(e),setCookie("settings-front-end",e,1780)}function setSettings(){checkCookie("settings-front-end")&&$("#settings-front-end-url").val(getCookie("settings-front-end"))}function OnClickDeleteMeSure(){$.ajax({url:API_ADDRESS+"accounts/delete?username="+username+"&access_token="+access_token,contentType:"application/json;charset=UTF-8",type:"GET",success:function(e){"ok"==e.status?(deleteAllCookies(),alert("Deleted everything. Total items: "+e.msg.amount),Logout()):alert("Something went wrong. Your account is not deleted. Please inform the Owner of Hive-Discover")},error:function(e){alert("Something went wrong. Your account is not deleted. Please inform the Owner of Hive-Discover")}})}function OnClickBanMeSure(){$.ajax({url:API_ADDRESS+"accounts/ban?username="+username+"&access_token="+access_token,contentType:"application/json;charset=UTF-8",type:"GET",success:function(e){"ok"==e.status?(alert("OK. You banned yourself"),Logout()):alert("Something went wrong. Your account is not banned. Please inform the Owner of Hive-Discover")},error:function(e){alert("Something went wrong. Your account is not banned. Please inform the Owner of Hive-Discover")}})}$().ready((function(){document.getElementById("cards-exists")&&urlParams.get("q")&&document.getElementById("search-input")&&($("#search-input").val(urlParams.get("q")),SearchPosts())})),$().ready((function(){window.location.href.indexOf("/me/settings.html")&&setSettings()}));let stat_data=null;function doAccountDataChart(e){if(null!=stat_data)if(0!=CHARTS_READY){for(var t=[],n=0;n<24;n++)t.push([n,0]);stat_data.reports.forEach(e=>{e.account_data_queries&&(t[e.hour]=[e.hour,e.account_data_queries])});var o=new google.visualization.DataTable;o.addColumn("number","Hour"),o.addColumn("number","Requests"),o.addRows(t);new google.charts.Line(document.getElementById("stats-chart-account-data-requests")).draw(o,google.charts.Line.convertOptions({chart:{title:"Account Data Requests Per Hour",height:250}})),setTimeout(e,250)}else setTimeout(doAccountDataChart,250)}function doAuthorQueriesChart(e){if(null!=stat_data)if(0!=CHARTS_READY){for(var t=[],n=0;n<24;n++)t.push([n,0]);stat_data.reports.forEach(e=>{e.account_queries&&(t[e.hour]=[e.hour,e.account_queries])});var o=new google.visualization.DataTable;o.addColumn("number","Hour"),o.addColumn("number","Queries"),o.addRows(t);new google.charts.Line(document.getElementById("stats-chart-account-queries")).draw(o,google.charts.Line.convertOptions({chart:{title:"Account Queries per Hour",height:250}})),setTimeout(e,250)}else setTimeout(doAuthorQueriesChart,250)}function doPostQueriesChart(e){if(null!=stat_data)if(0!=CHARTS_READY){for(var t=[],n=0;n<24;n++)t.push([n,0]);stat_data.reports.forEach(e=>{e.post_queries&&(t[e.hour]=[e.hour,e.post_queries])});var o=new google.visualization.DataTable;o.addColumn("number","Hour"),o.addColumn("number","Queries"),o.addRows(t);new google.charts.Line(document.getElementById("stats-chart-post-queries")).draw(o,google.charts.Line.convertOptions({chart:{title:"Post Queries per Hour",height:250}})),setTimeout(e,250)}else setTimeout(doPostQueriesChart,250)}function doFeedQueriesChart(e){if(null!=stat_data)if(0!=CHARTS_READY){for(var t=[],n=0;n<24;n++)t.push([n,0]);stat_data.reports.forEach(e=>{e.feed_requests&&(t[e.hour]=[e.hour,e.feed_requests])});var o=new google.visualization.DataTable;o.addColumn("number","Hour"),o.addColumn("number","Requests"),o.addRows(t);new google.charts.Line(document.getElementById("stats-chart-feed-requests")).draw(o,google.charts.Line.convertOptions({chart:{title:"Feed Requests per Hour",height:250}})),setTimeout(e,250)}else setTimeout(doFeedQueriesChart,250)}function doRequestTypesChart(e){if(null!=stat_data)if(0!=CHARTS_READY){var t=[["author_queries",0],["post_queries",0],["feed_requests",0],["account_data",0]];stat_data.reports.forEach(e=>{e.account_queries&&(t[0][1]=t[0][1]+e.account_queries),e.post_queries&&(t[1][1]=t[1][1]+e.post_queries),e.feed_requests&&(t[2][1]=t[2][1]+e.feed_requests),e.account_data_queries&&(t[3][1]=t[3][1]+e.account_data_queries)});var n=[["Topic","Value"]];t.forEach((function(e){n.push(e)}));new google.visualization.PieChart(document.getElementById("stats-chart-types")).draw(google.visualization.arrayToDataTable(n),{backgroundColor:"transparent",title:"Request Types:",enableInteractivity:!1,height:500,pieHole:.1}),setTimeout(e,250)}else setTimeout(doRequestTypesChart,250)}function doRequestConnectionsChart(e){if(null!=stat_data)if(0!=CHARTS_READY){for(var t=[],n=0;n<24;n++)t.push([n,0,0]);stat_data.reports.forEach(e=>{t[e.hour]=[e.hour,e.connections,e.requests]});var o=new google.visualization.DataTable;o.addColumn("number","Hour"),o.addColumn("number","Connections"),o.addColumn("number","Requests"),o.addRows(t);new google.charts.Line(document.getElementById("stats-chart-request-connections")).draw(o,google.charts.Line.convertOptions({chart:{title:"Requests and Connections per Hour",subtitle:"(collected anonym)",height:500}})),setTimeout(e,250)}else setTimeout(doRequestConnectionsChart,250)}function GetStats(){$.ajax({url:API_ADDRESS+"stats/",contentType:"application/json;charset=UTF-8",type:"GET",success:function(e){console.log(e),"ok"==e.status&&(stat_data=e,doRequestConnectionsChart(),doRequestTypesChart(),doFeedQueriesChart(),doPostQueriesChart(),doAuthorQueriesChart(),doAccountDataChart())},error:function(e){console.log(e)}})}$().ready((function(){location.href.indexOf("stats.html")>-1&&GetStats()}));