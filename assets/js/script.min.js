var j$=jQuery,$mContainer=j$("#mnsry_container"),$filterButton=j$(".button"),$loadingMessage=j$("#loading_msg");$params={itemSelector:".item",filtersGroupSelector:".filters"},j$(window).load((function(){$mContainer.multipleFilterMasonry($params),$mContainer.find("article").animate({opacity:1},1200),$loadingMessage.fadeOut(),$filterButton.find("input").change((function(){j$(this).parent().toggleClass("active")}))}));let logged_in=!1,checked_logging_state=!1,client=null,username="",access_token="";function LoginViaHiveSigner(){0==logged_in&&client.login({})}function Logout(){client.revokeToken((function(e,t){deleteAllCookies(),window.location.replace("/")}))}function setCategoriesChart(e,t){if(0!=CHARTS_READY){for(var o=[["Topic","Value"]],n=0;n<t.length;n++)t[n].value>.05&&o.push([t[n].label,t[n].value]);new google.visualization.PieChart(document.getElementById(e)).draw(google.visualization.arrayToDataTable(o),{backgroundColor:"transparent",title:"Our AI thinks that these topics might fit to you:",enableInteractivity:!1,height:600,pieHole:.1})}else setTimeout((function(){setCategoriesChart(e,t)}),250)}function getAccountAPIData(){$.ajax({url:API_ADDRESS+"/get-account?username="+username+"&access_token="+access_token,contentType:"application/json;charset=UTF-8",type:"GET",success:function(e){"ok"==e.status&&(setCategoriesChart("chart-account-categories",e.categories),console.log(e)),document.getElementById("loading-animator").style.display="none"},error:function(e){console.log(e)}})}$().ready((function(){if(client=new hivesigner.Client({app:"action-chain",callbackURL:"http://127.0.0.1:8000/me/login.html",scope:["login"]}),urlParams.get("access_token")&&urlParams.get("expires_in")&&urlParams.get("username"))return client.setAccessToken([urlParams.get("access_token")]),void client.me((function(e,t){t?(setCookie("access_token",urlParams.get("access_token"),urlParams.get("expires_in")/60/24),setCookie("username",urlParams.get("username"),urlParams.get("expires_in")/60/24),window.location.replace("/me/account.html")):alert("Something went wrong")}));checkCookie("username")&&checkCookie("access_token")?(logged_in=!0,username=getCookie("username"),access_token=getCookie("access_token"),client.setAccessToken([access_token]),window.location.href.indexOf("explore.html")>-1&&window.location.replace("/me/feed.html"),client.me((function(e,t){t?(console.log(t),window.location.href.indexOf("/me/account.html")>-1&&getAccountAPIData(),window.location.href.indexOf("/me/feed.html")>-1&&(post_cards_mode="feed",getFeedAPIData(start_setting=!0))):alert("Wrong access token"),checked_logging_state=!0})),document.getElementById("label-welcome-username")&&(document.getElementById("label-welcome-username").innerText="Welcome, "+username),document.getElementById("navbar-account")&&(document.getElementById("navbar-account").style.display="block"),document.getElementById("navbar-login")&&(document.getElementById("navbar-login").style.display="none")):(checked_logging_state=!0,document.getElementById("need-login")&&window.location.replace("/explore.html")),window.location.href.indexOf("logout.html")>-1&&Logout()}));const urlParams=new URLSearchParams(window.location.search),API_ADDRESS="http://192.168.178.20:8888/";let CHARTS_READY=!1;function openHiveSite(e){alert(e)}function OnSearchBarGo(){let e=$("#search-field").val();window.location.href="/search-posts.html?q="+e}function makeid(e){for(var t="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=o.length,a=0;a<e;a++)t+=o.charAt(Math.floor(Math.random()*n));return t}function setCookie(e,t,o){var n=new Date;n.setTime(n.getTime()+24*o*60*60*1e3);var a="expires="+n.toUTCString();document.cookie=e+"="+t+";"+a+";path=/"}function getCookie(e){for(var t=e+"=",o=decodeURIComponent(document.cookie).split(";"),n=0;n<o.length;n++){for(var a=o[n];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""}function checkCookie(e){return""!=getCookie(e)}function deleteAllCookies(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var o=e[t],n=o.indexOf("="),a=n>-1?o.substr(0,n):o;document.cookie=a+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"}}$().ready((function(){google.charts.load("current",{packages:["corechart","line"]}),google.charts.setOnLoadCallback((function(){CHARTS_READY=!0}))}));let item_count=0,open_posts=[],query="",post_cards_mode="",settings_posts=!1;function setCardWithPost(e,t){hivejs.api.getContent(e,t,(function(e,t){if(t){var o=JSON.parse(t.json_metadata),n=(o.tags,document.createElement("div"));n.innerHTML=t.body;var a=n.innerText;a=(a=(a=(a=a.replace(/[\(\[].*?[\)\]]/,"")).replace(/(?:https?|ftp):\/\/[\n\S]+/g,"")).replace(/(?:http?|ftp):\/\/[\n\S]+/g,"")).replace("!(","");var s=[];"image"in o&&(s=o.image);for(var r=0;r<n.getElementsByTagName("img").length;r++)s.push(n.getElementsByTagName("img")[r].src);var i={AUTHOR:t.author,TITLE:t.title,BODY:a,POST_URL:t.url};s.length>0&&(i.BACKGROUND_IMG=s[0]);let e=null;null==e&&(e=Handlebars.compile(document.getElementById("card-holder-3").innerHTML));let c=e(i);if($("#card-row-1").height()<$("#card-row-2").height()&&$("#card-row-1").height()<$("#card-row-3").height())document.getElementById("card-row-1").innerHTML+=c;else if($("#card-row-2").height()<$("#card-row-1").height()&&$("#card-row-2").height()<$("#card-row-3").height())document.getElementById("card-row-2").innerHTML+=c;else if($("#card-row-3").height()<$("#card-row-1").height()&&$("#card-row-3").height()<$("#card-row-2").height())document.getElementById("card-row-3").innerHTML+=c;else switch(console.log($("#card-row-1").outerHeight(),$("#card-row-2").outerHeight(),$("#card-row-3").outerHeight()),item_count%3){case 0:document.getElementById("card-row-1").innerHTML+=c;break;case 1:document.getElementById("card-row-2").innerHTML+=c;break;case 2:document.getElementById("card-row-3").innerHTML+=c}item_count+=1}}))}function loadSomePosts(e=10,t=!1){e<=0?settings_posts=!1:0==t&1==settings_posts||(settings_posts=!0,0==open_posts.length&&("search"==post_cards_mode&&getApiSearchData(start_setting=!1),"feed"==post_cards_mode&&getFeedAPIData(start_setting=!1),settings_posts=!1,setTimeout((function(){loadSomePosts(e-=1)}),1500)),post=open_posts.shift(),setCardWithPost(post.a,post.p),setTimeout((function(){loadSomePosts(e-=1,t=!0)}),500))}function getApiSearchData(e=!1){$.ajax({url:API_ADDRESS+"/search-post?q="+query,contentType:"application/json;charset=UTF-8",type:"GET",success:function(t){if("ok"==t.status){for(var o=0;o<t.posts.length;o++)open_posts.push(t.posts[o]);if(0==open_posts.length)return document.getElementById("posts-not-found").style.display="block",void(document.getElementById("loading-animator").style.display="none");e&&loadSomePosts(25)}},error:function(e){console.log(e)}})}function getFeedAPIData(e=!1){null!=access_token?$.ajax({url:API_ADDRESS+"/get-feed?username="+username+"&access_token="+access_token,contentType:"application/json;charset=UTF-8",type:"GET",success:function(t){for(var o=0;o<t.posts.length;o++)open_posts.push(t.posts[o]);0!=open_posts.length?e&&loadSomePosts(25):setTimeout(()=>{getFeedAPIData(e=e)},200)},error:function(e){console.log(e)}}):setTimeout((function(){getFeedAPIData(e=e)}),250)}function resetViewToLoading(){document.getElementById("card-row-1").innerHTML="",document.getElementById("card-row-2").innerHTML="",document.getElementById("card-row-3").innerHTML="",document.getElementById("posts-introduction").style.display="none",document.getElementById("posts-not-found").style.display="none",document.getElementById("loading-animator").style.display="block"}function SearchPosts(){query=$("#search-input").val(),""!=query&&" "!=query&&(resetViewToLoading(),post_cards_mode="search",getApiSearchData(start_setting=!0))}$().ready((function(){document.getElementById("cards-exists")&&urlParams.get("q")&&document.getElementById("search-input")&&($("#search-input").val(urlParams.get("q")),SearchPosts())})),$(window).scroll((function(){$(window).scrollTop()+$(window).height()==$(document).height()&&item_count>6&&loadSomePosts()}));let stat_data=null;function doAuthorQueriesChart(e){if(null!=stat_data)if(0!=CHARTS_READY){var t=new google.visualization.DataTable;t.addColumn("number","Hour"),t.addColumn("number","");for(var o=0;o<stat_data.data.length;o++)t.addRow([o,stat_data.data[o].account_queries]);new google.charts.Line(document.getElementById("stats-chart-account-queries")).draw(t,google.charts.Line.convertOptions({chart:{title:"Account_queries per Hour",height:150}})),setTimeout(e,250)}else setTimeout(doRequestConnectionsChart,250)}function doPostQueriesChart(e){if(null!=stat_data)if(0!=CHARTS_READY){var t=new google.visualization.DataTable;t.addColumn("number","Hour"),t.addColumn("number","");for(var o=0;o<stat_data.data.length;o++)t.addRow([o,stat_data.data[o].post_queries]);new google.charts.Line(document.getElementById("stats-chart-post-queries")).draw(t,google.charts.Line.convertOptions({chart:{title:"Post_queries per Hour",height:150}})),setTimeout(e,250)}else setTimeout(doRequestConnectionsChart,250)}function doFeedQueriesChart(e){if(null!=stat_data)if(0!=CHARTS_READY){var t=new google.visualization.DataTable;t.addColumn("number","Hour"),t.addColumn("number","");for(var o=0;o<stat_data.data.length;o++)t.addRow([o,stat_data.data[o].feed_requested]);new google.charts.Line(document.getElementById("stats-chart-feed-requests")).draw(t,google.charts.Line.convertOptions({chart:{title:"Feed requests per Hour",height:150}})),setTimeout(e,250)}else setTimeout(doRequestConnectionsChart,250)}function doRequestTypesChart(e){if(null!=stat_data)if(0!=CHARTS_READY){for(var t=[["author_queries",0],["post_queries",0],["feed_requests",0]],o=0;o<stat_data.data.length;o++)t[0][1]=t[0][1]+stat_data.data[o].author_queries,t[1][1]=t[1][1]+stat_data.data[o].post_queries,t[2][1]=t[2][1]+stat_data.data[o].feed_requested;var n=[["Topic","Value"]];t.forEach((function(e){n.push(e)})),console.log(n);new google.visualization.PieChart(document.getElementById("stats-chart-types")).draw(google.visualization.arrayToDataTable(n),{backgroundColor:"transparent",title:"Request Types:",enableInteractivity:!1,height:500,pieHole:.1}),setTimeout(e,250)}else setTimeout(doRequestTypesChart,250)}function doRequestConnectionsChart(e){if(null!=stat_data)if(0!=CHARTS_READY){var t=new google.visualization.DataTable;t.addColumn("number","Hour"),t.addColumn("number","Connections"),t.addColumn("number","Requests");for(var o=0;o<stat_data.data.length;o++)t.addRow([o,stat_data.data[o].connections,stat_data.data[o].requests]);new google.charts.Line(document.getElementById("stats-chart-request-connections")).draw(t,google.charts.Line.convertOptions({chart:{title:"Requests and Connections per Hour",subtitle:"(collected anonym)",height:500}})),setTimeout(e,250)}else setTimeout(doRequestConnectionsChart,250)}function GetStats(e=null){let t="";e&&(t="?date="+e),$.ajax({url:API_ADDRESS+"/get-stats"+t,contentType:"application/json;charset=UTF-8",type:"GET",success:function(e){"ok"==e.status&&(stat_data=e,doRequestConnectionsChart(doFeedQueriesChart(doPostQueriesChart(doAuthorQueriesChart(doRequestTypesChart())))))},error:function(e){console.log(e)}})}$().ready((function(){location.href.indexOf("stats.html")>-1&&GetStats()}));