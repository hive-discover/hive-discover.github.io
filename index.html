<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="../assets/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>
        Discover
    </title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
        name='viewport' />

    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css"
        integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

    <!-- Canonical SEO -->
    <link rel="canonical" href="https://www.creative-tim.com/product/hipster-as-f-cards" />

    <!-- CSS Files -->

    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />

    <link href="assets/css/loading-animator.css" rel="stylesheet" />
    <link href="../assets/css/now-ui-kit.css?v=1.3.0" rel="stylesheet" />
    <link href="discover/assets/css/hipster_cards.css" rel="stylesheet" />
    <link href="discover/assets/css/demo.css" rel="stylesheet" />

    <!-- CSS Just for demo purpose, don't include it in your project 
    <link href="../assets/demo/demo.css" rel="stylesheet" />-->
</head>

<body class="landing-page sidebar-collapse">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-primary fixed-top navbar-transparent " color-on-scroll="400">
        <div class="container">
            <div class="dropdown button-dropdown">
                <a href="#" class="dropdown-toggle" id="navbarDropdown" data-toggle="dropdown">
                    <span class="button-bar"></span>
                    <span class="button-bar"></span>
                    <span class="button-bar"></span>
                </a>

            </div>
            <div class="navbar-translate">
                <a class="navbar-brand" href="javascript: openHiveSite('/@action-chain')">
                    Hive Discover
                </a>
                <button class="navbar-toggler navbar-toggler" type="button" data-toggle="collapse"
                    data-target="#navigation" aria-controls="navigation-index" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-bar top-bar"></span>
                    <span class="navbar-toggler-bar middle-bar"></span>
                    <span class="navbar-toggler-bar bottom-bar"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse justify-content-end" id="navigation"
                data-nav-image="../assets/img/blurred-image-1.jpg">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="javascript: openHiveSite('/@action-chain')">Learn more</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/hive-discover" target="_blank">
                            <i class="fab fa-github"></i>
                            <p class="d-lg-none d-xl-none">GitHub</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="javascript: openSettings()">
                            <i class="fas fa-cogs"></i>
                            <p class="d-lg-none d-xl-none">Settings</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- End Navbar -->

    <div class="wrapper">
        <div class="page-header page-header" id="page-header">
            <div class="page-header-image" data-parallax="true">
            </div>
            <div class="content-center">
                <div class="container">
                    <h1 class="title">Discover more on HIVE</h1>
                    <hr />
                    <h4 class="description" id="info-search">Enter a topic or theme</h4>
                    <h4 class="description" id="info-explore" style="display: none">Enter your Username</h4>
                    <h4 class="description" id="info-accounts" style="display: none">Enter an Username fragment</h4>
                    <br />
                    <div class="form-group">
                        <div class="row">
                            <div class="btn-group col-md-2" style="margin: auto">
                                <button type="button" class="btn btn-fill btn-primary btn-modern col-md-10"
                                    id="search-mode-selected">Mode</button>
                                <button type="button"
                                    class="btn btn-fill btn-info btn-modern dropdown-toggle dropdown-toggle-split col-md-2"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" href="javascript: setSearchMode('Search');">Search</a>
                                    <a class="dropdown-item" href="javascript: setSearchMode('Explore');">Explore</a>
                                    <a class="dropdown-item" href="javascript: setSearchMode('Accounts');">Accounts</a>
                                </div>

                            </div>
                            <div class="col-md-8">
                                <div>
                                    <!-- class="form-group"-->

                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <div class="input-group-text"><i class="fa fa-search"></i></div>
                                        </div>
                                        <input type="text" id="txt-search" class="form-control"
                                            placeholder="Account, Topic, Hashtag, your Username..."
                                            style="background-color: white; color: black">
                                    </div>

                                </div>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-fill btn-primary btn-modern" onclick="Search();">
                                    <i class="fa fa-brain"></i>
                                    SEARCH </button>
                            </div>
                        </div>
                        <br />
                        <a class="btn btn-fill btn-primary btn-modern" id="link-profile-overview" style="display: none">
                            <i class="fa fa-chart-pie"></i>
                            Check out your Profile Overview </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="container" id="results-container" style="display: none">
            <br />
            <div id="profiler-info">
                <div class="progress-container progress-danger" id="progress-bar-container">
                    <span class="progress-badge">
                        Your profile is currently in work
                    </span>
                    <div class="progress">
                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60"
                            aria-valuemin="0" aria-valuemax="100" style="width: 0%;" id="progress-bar-width">
                            <span class="progress-value" id="progress-bar-value">0%</span>
                        </div>
                    </div>
                </div>
                <hr />
            </div>


            <div class="row">
                <div id="content-container-1" class="col-md-4">
                </div>
                <div id="content-container-2" class="col-md-4">
                </div>
                <div id="content-container-3" class="col-md-4">
                </div>
            </div>

            <!-- Loading Animator -->
            <div id="loading_animation" class="text-center">
                <div class="lds-roller">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
                <p>Loading</p>
            </div>
        </div>

        <footer class="footer footer-info">
            <div class=" container ">
                <nav>
                    <ul>
                        <li>
                            <a href="javascript: openHiveSite('/@action-chain');">
                                Action-Chain
                            </a>
                        </li>
                        <li>
                            <a href="javascript: openHiveSite('/@action-chain');">
                                Blog
                            </a>
                        </li>
                        <li>
                            <a href="javascript: openHiveSite('/@action-chain');">
                                Impressum
                            </a>
                        </li>
                        <li>
                            <a href="javascript: openHiveSite('/@action-chain');">
                                Data Protection
                            </a>
                        </li>
                    </ul>
                </nav>
                <div class="copyright" id="copyright">
                    &copy;
                    <script>
                        document.getElementById('copyright').appendChild(document.createTextNode(new Date().getFullYear()))
                    </script>, Developed by <a href="javascript: openHiveSite('/@action-chain');">Action-Chain</a>.
                </div>
            </div>
        </footer>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" id="settings-modal"
        aria-labelledby="settings-modal" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Settings</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body text-center">

                    <h4 class="title" style="margin: auto">Choose Front-End</h4>

                    <div class="btn-group" style="width: 80%;">
                        <button type="button" class="btn btn-fill btn-primary btn-modern col-md-10"
                            id="settings-frontend-selected">Peakd</button>
                        <button type="button"
                            class="btn btn-fill btn-info btn-modern dropdown-toggle dropdown-toggle-split col-md-2"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="sr-only">Toggle Dropdown</span>
                        </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="javascript: setFrontEnd('Hive Blog');">Hive Blog</a>
                            <a class="dropdown-item" href="javascript: setFrontEnd('Peakd');">Peakd</a>
                            <a class="dropdown-item" href="javascript: setFrontEnd('Leo Finance');">Leo Finance</a>
                            <a class="dropdown-item" href="javascript: setFrontEnd('Ecency');">Ecency</a>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">

                </div>

            </div>
        </div>
    </div>


    <!-- Card Holders -->
    <div style="display: none">
        <div id="card-holder-1">
            <div class="card-box col-md-12 col-sm-6" style="margin: auto">
                <div class="card">
                    <div class="header">
                        <img src="{{IMAGE_SRC}}" />
                        <div class="filter"></div>

                        <div class="actions">
                            <button class="btn btn-round btn-fill btn-neutral btn-modern"
                                onclick="openHiveSite('{{POST_URL}}')">
                                Read
                            </button>
                        </div>
                    </div>

                    <div class="content">
                        <h6 class="category" style="margin: auto">
                            <a href="javascript: openHiveSite('/@{{AUTHOR}}')">
                                <img id="{{AUTHOR_IMG_ID}}" src="assets/img/default-avatar.png"
                                    style="max-width: 30px;" />
                                {{AUTHOR}}
                            </a>
                        </h6>
                        <h4 class="title"><a href="javascript: openHiveSite('{{POST_URL}}')">{{TITLE}}</a>
                        </h4>
                        <p class="description"
                            style="overflow: hidden; display: -webkit-box; text-overflow: ellipsis; -webkit-line-clamp: 7; -webkit-box-orient: vertical; color: black;">
                            {{BODY}}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div id="card-holder-2">
            <div class="card-box col-md-12 col-sm-6" style="margin: auto" onclick="openHiveSite('{{POST_URL}}')">
                <div class="card" data-background="image" data-src="{{IMAGE_SRC}}">
                    <div class="header">

                    </div>

                    <div class="content">
                        <h4 class="title title-uppercase"
                            style="overflow: hidden; display: -webkit-box; text-overflow: ellipsis; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                            {{TITLE}}
                        </h4>
                        <div class="category">
                            <a href="javascript: openHiveSite('/@{{AUTHOR}}')">
                                <img id="{{AUTHOR_IMG_ID}}" src="assets/img/default-avatar.png"
                                    style="max-width: 30px;" />
                                {{AUTHOR}}
                            </a>
                        </div>
                        <p class="description"
                            style="overflow: hidden; display: -webkit-box; text-overflow: ellipsis; -webkit-line-clamp: 5; -webkit-box-orient: vertical;">
                            {{BODY}}</p>
                    </div>
                    <div class="filter">

                    </div>
                </div> <!-- end card -->
            </div>
        </div>

        <div id="card-holder-3">
            <div class="card-box col-md-12 col-sm-6" style="margin: auto">
                <div class="card">
                    <div class="content">
                        <h6 class="category"><a href="javascript: openHiveSite('/@{{AUTHOR}}')">
                                <img id="{{AUTHOR_IMG_ID}}" src="assets/img/default-avatar.png"
                                    style="max-width: 30px;" />
                                {{AUTHOR}}
                            </a></h6>
                        <h4 class="title"><a href="javascript: openHiveSite('{{POST_URL}}')">{{TITLE}}</a></h4>
                        <p class="description"
                            style="overflow: hidden; display: -webkit-box; text-overflow: ellipsis; -webkit-line-clamp: 19; -webkit-box-orient: vertical; color: black;">
                            <a href="javascript: openHiveSite('{{POST_URL}}')"> {{BODY}}</a>
                        </p>
                    </div>
                </div> <!-- end card -->
            </div>
        </div>

        <div id="card-holder-4">
            <div class="card-box col-md-12 col-sm-6" style="margin: auto" onclick="openHiveSite('{{POST_URL}}')">
                <div class="card card-just-text card-with-border" data-background="image" data-src="{{IMAGE_SRC}}">
                    <div class="content">
                        <h4 class="title title-modern">"{{TITLE}}"</h4>
                        <p class="description">- {{AUTHOR}}</p>
                    </div>
                    <div class="filter"></div>
                </div> <!-- end card -->
            </div>
        </div>

        <div id="card-holder-5">
            <div class="card col-md-12">
                <div class="card-header" style="cursor: pointer; height: 250px; width: 100%; margin: auto"
                    data-background="image" onclick="openHiveSite({{ACCOUNT_LINK}})" data-src="{{COVER_IMAGE}}">

                    <div class="row">
                        <div class="col-md-3"></div>
                        <img class="col-md-6" style="width: 100%; border-radius: 50%; margin-top: 150px;"
                            src="{{PROFILE_IMAGE}}" />
                        <div class="col-md-3"></div>
                    </div>
                </div>
                <br /> <br />
                <div class="card-content text-center">
                    <h6 class="category" style="color: black"><strong>{{ACCOUNT_NAME}}</strong></h6>
                    <h6 class="category" onclick="openHiveSite({{ACCOUNT_LINK}})"
                        style="cursor: pointer; padding-top: 5px;">
                        <strong>@{{ACCOUNT_USER_NAME}}</strong>
                    </h6>
                    <h4 class="category" style="overflow: hidden; display: -webkit-box; text-overflow: ellipsis; -webkit-line-clamp: 7; -webkit-box-orient: vertical; 
                color: rgba(0, 0, 0, 0.692)">
                        {{DESCRIPTION}}
                    </h4>
                    <hr />
                    <div class="row">
                        <div class="col-md-4">
                            <h5 class="category"><strong>Follower</strong></h5>
                            <h5 style="color: black" id="{{FOLLOWER_COUNT_ID}}"></h5>
                        </div>
                        <div class="col-md-4">
                            <h5 class="category"><strong>Posts</strong></h5>
                            <h5 style="color: black">{{POST_COUNT}}</h5>
                        </div>
                        <div class="col-md-4">
                            <h5 class="category"><strong>Following</strong></h5>
                            <h5 style="color: black" id="{{FOLLOWING_COUNT_ID}}"></h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!--   Core JS Files   -->
    <script src="../assets/js/core/jquery.min.js" type="text/javascript"></script>
    <script src="../assets/js/core/popper.min.js" type="text/javascript"></script>
    <script src="../assets/js/core/bootstrap.min.js" type="text/javascript"></script>
    <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
    <script src="../assets/js/plugins/bootstrap-switch.js"></script>
    <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="../assets/js/plugins/nouislider.min.js" type="text/javascript"></script>
    <!--  Plugin for the DatePicker, full documentation here: https://github.com/uxsolutions/bootstrap-datepicker -->
    <script src="../assets/js/plugins/bootstrap-datepicker.js" type="text/javascript"></script>
    <!--  Google Maps Plugin    -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
    <!-- Control Center for Now Ui Kit: parallax effects, scripts for the example pages etc -->
    <script src="../assets/js/now-ui-kit.js?v=1.3.0" type="text/javascript"></script>

    <script src="discover/assets/js/hipster-cards.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/3.3.1/masonry.pkgd.min.js"></script>
    <script src="discover/assets/js/demo.js"></script>

    <script src="assets/js/config.js"></script>
    <script src="assets/js/cookie-manager.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@hivechain/hivejs/dist/hivejs.min.js"></script>

    <script>
        google.charts.load('current', { 'packages': ['corechart'] });

        // Global variables
        const urlParams = new URLSearchParams(window.location.search);
        open_data = [];
        posts = [];
        item_index = 0;
        username = null;
        url = null;

        function SetOpenData(amount = 12) {
            // Get one post/account item (the first one) 
            // Next one via recursion

            if (open_data.length > 0 && amount > 0) {
                // Get post
                item = open_data[0]
                open_data.shift();

                var mode = $("#search-mode-selected").text();
                if (mode == "Accounts")
                    get_account(item);
                else
                    get_post(item["a"], item["p"]);
                SetOpenData(amount - 1);
            }

            if (open_data.length == 0 && url != null) {
                // Get more data
                GetAPIData();
            }
        }

        function GetAPIData(start_setting_data = false) {
            // Ajax call to API
            $.ajax({
                url: url,
                contentType: 'application/json;charset=UTF-8',
                type: 'GET',
                success: function (response) {
                    if (response.status == "ok") {

                        if ("posts" in response) {
                            if (response.posts.length > 0) {
                                for (var i = 0; i < response.posts.length; i++) {
                                    // Push all
                                    open_data.push(response.posts[i]);
                                }
                            } else {
                                // Rerun in some seconds
                                setTimeout(function () { GetAPIData(start_setting_data = start_setting_data) }, 200);
                            }
                        }
                        if ("accounts" in response) {
                            for (var i = 0; i < response.accounts.length; i++) {
                                // Push all
                                open_data.push(response.accounts[i]);
                            }
                        }
                    }

                    if (start_setting_data)
                        SetOpenData();
                },
                error: function (error) {
                    alert("Something went wrong.")
                }
            });
        }

        function Search(delete_old = true, user_exists = false) {
            var query = $("#txt-search").val();
            if (query.length == 0) {
                return;
            }

            if (delete_old) {
                // Show Loading
                $("#results-container").attr("style", "");
                $("#page-header").attr("class", "page-header page-header-small");
                $("#profiler-info").attr("style", "display: none;");
                document.getElementById("link-profile-overview").style = "display: none";
                document.getElementById("content-container-1").innerHTML = "";
                document.getElementById("content-container-2").innerHTML = "";
                document.getElementById("content-container-3").innerHTML = "";
                $("#loading_animation").attr("style", "");

                // Reset 
                posts = [];
                open_data = []
                username = null;
                item_index = 0;
            }

            // Get correct Mode
            switch ($("#search-mode-selected").text()) {
                case "Explore":
                    // Explore Mode
                    if (user_exists == false) {
                        // Check username
                        hivejs.api.getAccounts([query], function (err, result) {
                            if (err) {
                                alert("User does not exist");
                                return;
                            }
                            // Exists
                            Search(delete_old = true, user_exists = true);
                        });
                        return;
                    }
                    username = query;
                    url = API_ADDRESS + "/get-feed?username=" + query + "&data=true";


                    document.getElementById("link-profile-overview").style = "";
                    document.getElementById("link-profile-overview").href = "./data.html?u=" + username;
                    setTimeout(getProfilerInfo, 50);
                    break;
                case "Accounts":
                    // Search for an Account
                    url = API_ADDRESS + "/search-account?q=" + query + "&data=true";
                    break;
                default:
                    // Search for Posts
                    url = API_ADDRESS + "/search-post?q=" + query + "&data=true";
                    break;
            }

            GetAPIData(start_setting_data = true);
        }

        function get_account(name) {
            hivejs.api.getAccounts([name], function (err, result) {
                if (result) {
                    if (result.length > 0) {
                        var acc = result[0];
                        if ("json_metadata" in acc) {
                            var metadata = JSON.parse(acc.json_metadata);
                            var context = {
                                FOLLOWER_COUNT_ID: "text-follower-count-" + makeid(7),
                                FOLLOWING_COUNT_ID: "text-following-count-" + makeid(7),
                                POST_COUNT: acc["post_count"],
                                PROFILE_IMAGE: metadata["profile"]["profile_image"],
                                ACCOUNT_NAME: metadata["profile"]["name"],
                                ACCOUNT_USER_NAME: acc["name"],
                                ACCOUNT_LINK: "/@" + acc["name"],
                                DESCRIPTION: metadata["profile"]["about"],
                                COVER_IMAGE: metadata["profile"]["cover_image"],
                            };

                            var template = Handlebars.compile(document.getElementById("card-holder-5").innerHTML);
                            var card_obj = template(context);
                            item_index += 1;

                            // Set in right column   
                            if ($("#content-container-1").height() < $("#content-container-2").height() && $("#content-container-1").height() < $("#content-container-3").height())
                                document.getElementById("content-container-1").innerHTML += card_obj;
                            else if ($("#content-container-2").height() < $("#content-container-1").height() && $("#content-container-2").height() < $("#content-container-3").height())
                                document.getElementById("content-container-2").innerHTML += card_obj;
                            else if ($("#content-container-3").height() < $("#content-container-1").height() && $("#content-container-3").height() < $("#content-container-2").height())
                                document.getElementById("content-container-3").innerHTML += card_obj;
                            else {
                                // Fill based on item_index
                                switch ((item_index - 1) % 3) {
                                    case 0:
                                        document.getElementById("content-container-1").innerHTML += card_obj;
                                        break;
                                    case 1:
                                        document.getElementById("content-container-2").innerHTML += card_obj;
                                        break;
                                    case 2:
                                        document.getElementById("content-container-3").innerHTML += card_obj;
                                        break;
                                }
                            }

                            function setFollowAPI(context) {
                                hivejs.api.getFollowCount(acc["name"], function (err, result) {
                                    if (result) {
                                        document.getElementById(context.FOLLOWER_COUNT_ID).innerText = result.follower_count;
                                        document.getElementById(context.FOLLOWING_COUNT_ID).innerText = result.following_count;
                                    }
                                });
                            }
                            setFollowAPI(context);
                        }
                    }
                }
            });
        }

        function setFrontEnd(selected) {
            setCookie("front-end", selected, 20);
            openSettings(show = false);
        }

        function setSearchMode(selected) {
            $("#search-mode-selected").text(selected);

            if ("Explore" == selected) {
                $("#info-search").attr("style", "display: none;");
                $("#info-accounts").attr("style", "display: none;");
                $("#info-explore").attr("style", "");
            }
            if ("Search" == selected) {
                $("#info-accounts").attr("style", "display: none;");
                $("#info-search").attr("style", "");
                $("#info-explore").attr("style", "display: none;");
            }
            if ("Accounts" == selected) {
                $("#info-accounts").attr("style", "");
                $("#info-search").attr("style", "display: none;");
                $("#info-explore").attr("style", "display: none;");
            }
        }

        function openSettings(show = true) {

            var frontend = getCookie("front-end");
            if (frontend == null)
                frontend = "Peakd";
            $("#settings-frontend-selected").text(frontend);


            $("#settings-modal").modal({ "show": show });
        }

        function makeid(length) {
            var result = '';
            var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            var charactersLength = characters.length;
            for (var i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            return result;
        }

        function getAuthorImg(author, img_id) {
            hivejs.api.getAccounts([author], function (err, result) {
                if (result) {
                    if (result.length > 0) {
                        var acc = result[0];
                        if ("json_metadata" in acc) {
                            var metadata = JSON.parse(acc.json_metadata);
                            if ("profile" in metadata)
                                document.getElementById(img_id).src = metadata["profile"]["profile_image"];
                        }
                    }
                }
            });
        }

        function get_post(author, permlink) {
            hivejs.api.getContent(author, permlink, function (err, result) {
                if (result) {
                    var metadata = JSON.parse(result['json_metadata']);
                    var tags = metadata["tags"]

                    var div = document.createElement("div");
                    div.innerHTML = result["body"];
                    var body = div.innerText;

                    // Make the body clean
                    body = body.replace(/[\(\[].*?[\)\]]/, "");
                    body = body.replace(/(?:https?|ftp):\/\/[\n\S]+/g, '');
                    body = body.replace(/(?:http?|ftp):\/\/[\n\S]+/g, '');
                    body = body.replace("!(", "")

                    // Get images
                    var images = [];
                    // Try to get them from metadata
                    if ("image" in metadata)
                        images = metadata["image"]

                    for (var i = 0; i < div.getElementsByTagName("img").length; i++) {
                        // Try Get img from body --> stand not in metadata
                        images.push(div.getElementsByTagName("img")[i].src);
                    }

                    var author_img_id = makeid(20);
                    var json = {
                        AUTHOR: result["author"],
                        TITLE: result["title"],
                        BODY: body,
                        POST_URL: result["url"],
                        AUTHOR_IMG_ID: author_img_id
                    };

                    if (images.length > 0)
                        json["IMAGE_SRC"] = images[0]

                    var template = null;
                    var author_img_possible = true;
                    if (body.length < 5 & images.length > 0) {
                        template = Handlebars.compile(document.getElementById('card-holder-4').innerHTML);
                        // No author img possible
                        author_img_possible = false;
                    }

                    if ((tags.includes("photography") || tags.includes("photo")) & body.length < 200)
                        template = Handlebars.compile(document.getElementById('card-holder-2').innerHTML);

                    if (template == null) {

                        if (images.length > 0)
                            template = Handlebars.compile(document.getElementById('card-holder-1').innerHTML);
                        else
                            template = Handlebars.compile(document.getElementById('card-holder-3').innerHTML);
                    }

                    var card_obj = template(json);
                    item_index += 1;

                    // Set in right column   
                    if ($("#content-container-1").height() < $("#content-container-2").height() && $("#content-container-1").height() < $("#content-container-3").height())
                        document.getElementById("content-container-1").innerHTML += card_obj;
                    else if ($("#content-container-2").height() < $("#content-container-1").height() && $("#content-container-2").height() < $("#content-container-3").height())
                        document.getElementById("content-container-2").innerHTML += card_obj;
                    else if ($("#content-container-3").height() < $("#content-container-1").height() && $("#content-container-3").height() < $("#content-container-2").height())
                        document.getElementById("content-container-3").innerHTML += card_obj;
                    else {
                        // Fill based on item_index
                        switch ((item_index - 1) % 3) {
                            case 0:
                                document.getElementById("content-container-1").innerHTML += card_obj;
                                break;
                            case 1:
                                document.getElementById("content-container-2").innerHTML += card_obj;
                                break;
                            case 2:
                                document.getElementById("content-container-3").innerHTML += card_obj;
                                break;
                        }
                    }

                    // Get author img                    
                    if (author_img_possible)
                        getAuthorImg(result["author"], author_img_id);
                }
            });
        }

        function getProfilerInfo() {
            if (username == null)
                return;

            // Get data
            $.ajax({
                url: API_ADDRESS + "/get-profiler?username=" + username,
                contentType: 'application/json;charset=UTF-8',
                type: 'GET',
                success: function (response) {
                    if (response.status == "ok") {
                        $("#profiler-info").attr("style", "");

                        if ("loading" in response) {
                            if (response.loading == false) {
                                $("#progress-bar-container").attr("style", "display: none");
                                // No reload because all data is there
                                return;
                            } else {
                                // Set progress bar
                                $("#progress-bar-container").attr("style", "");

                                progress = 0;

                                if (response.loading != true) {
                                    // is object --> can calc progress
                                    max = response.loading.max;
                                    current = response.loading.current;
                                    progress = parseInt((current / max) * 100);
                                }

                                $("#progress-bar-width").attr("style", "width: " + progress.toString() + ";");
                                $("#progress-bar-value").text(progress.toString() + "%");

                            }
                        }
                        setTimeout(getProfilerInfo, 500);
                    }
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

        function openHiveSite(link) {
            standard = "https://hive.blog";

            var frontend = getCookie("front-end");
            if (frontend == "Peakd")
                standard = "https://peakd.com";
            if (frontend == "Leo Finance")
                standard = "https://leofinance.io";
            if (frontend == "Ecency")
                standard = "https://ecency.com";


            window.open(standard + link, '_blank');
        }

        $().ready(function () {
            if (urlParams.get("mode") != null)
                setSearchMode(urlParams.get("mode"))

            if (urlParams.get("q") != null) {
                $("#txt-search").val(urlParams.get("q"));

                Search();
            }


            // Enter Press Event
            document.getElementById("txt-search").addEventListener("keyup", function (event) {
                // Number 13 is the "Enter" key on the keyboard
                if (event.keyCode === 13) {
                    event.preventDefault();
                    Search();
                }
            });
        });

        $(window).scroll(function () {
            if ($(window).scrollTop() + $(window).height() == $(document).height()) {
                // At the end of the site
                if (item_index > 0) {
                    // There are some items --> is searching
                    SetOpenData();
                }
            }
        });
    </script>

</body>

</html>