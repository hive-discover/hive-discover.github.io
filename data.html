<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="../assets/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>
        Discover
    </title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
        name='viewport' />

    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css"
        integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

    <!-- Canonical SEO -->
    <link rel="canonical" href="https://www.creative-tim.com/product/hipster-as-f-cards" />

    <!-- CSS Files -->

    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />

    <link href="assets/css/loading-animator.css" rel="stylesheet" />
    <link href="../assets/css/now-ui-kit.css?v=1.3.0" rel="stylesheet" />
    <link href="discover/assets/css/hipster_cards.css" rel="stylesheet" />
    <link href="discover/assets/css/demo.css" rel="stylesheet" />

    <!-- CSS Just for demo purpose, don't include it in your project 
    <link href="../assets/demo/demo.css" rel="stylesheet" />-->
</head>

<body class="landing-page sidebar-collapse">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-primary fixed-top navbar-transparent " color-on-scroll="400">
        <div class="container">
            <div class="dropdown button-dropdown">
                <a href="/" class="dropdown-toggle" id="navbarDropdown" data-toggle="dropdown">
                    <span class="button-bar"></span>
                    <span class="button-bar"></span>
                    <span class="button-bar"></span>
                </a>

            </div>
            <div class="navbar-translate">
                <a class="navbar-brand" href="/">
                    Hive Discover
                </a>
                <button class="navbar-toggler navbar-toggler" type="button" data-toggle="collapse"
                    data-target="#navigation" aria-controls="navigation-index" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-bar top-bar"></span>
                    <span class="navbar-toggler-bar middle-bar"></span>
                    <span class="navbar-toggler-bar bottom-bar"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse justify-content-end" id="navigation"
                data-nav-image="../assets/img/blurred-image-1.jpg">
                <ul class="navbar-nav">
                    <li class="nav-item">

                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- End Navbar -->

    <div class="wrapper">
        <div class="page-header page-header" id="page-header">
            <div class="page-header-image" data-parallax="true">
            </div>
            <div class="content-center" style="width: 100%">
                <div class="container" style="width: 100%">
                    <div id="account-not-exists-container" style="display: none">
                        <h1 class="title">We found nothing!</h1>
                        <hr />
                        <br />
                        <h4 class="description" id="account-not-exists-name"></h4>
                    </div>
                    <div id="account-exists-container" style="display: none">
                        <h1 class="title"> - Profile Overview - </h1>
                        <hr />
                        <br />
                        <div class="card">
                            <div class="card-header center">
                                <div class="row">
                                    <div class="col-md-4" style="margin: auto; max-width: 150px;">
                                        <img src="" name="author-img" style="border-radius: 50%;" />
                                    </div>
                                    <div class="col-md-8" style="margin: auto;">
                                        <p>
                                            <a href="" id="account-link" class="title text-center">

                                            </a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--Loading Bar when Account is analyzed-->
                        <div class="progress-container progress-danger" id="progress-bar-container">
                            <span class="progress-badge">
                                Your profile is currently in work
                            </span>
                            <div class="progress">
                                <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60"
                                    aria-valuemin="0" aria-valuemax="100" style="width: 0%;" id="progress-bar-width">
                                    <span class="progress-value" id="progress-bar-value">0%</span>
                                </div>
                            </div>
                        </div>


                    </div>



                    <div class="form-group">
                        <div class="row">
                            <!-- Loading Animator -->
                            <div id="loading_animation" class="text-center" style="margin: auto">
                                <div class="lds-roller">
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                </div>
                                <p>Loading</p>
                            </div>
                        </div>
                        <br />
                    </div>
                </div>
            </div>
        </div>

        <div class="container" id="results-container" style="display: none">

            <!-- Preferences -->
            <div style="width: 100%;" class="text-center">
                <div id="profiler-pie-chart"></div>
                <hr />
            </div>



            <!-- Delete account -->
            <div style="width: 100%;" class="text-center">
                <h1 class="title">Delete Account</h1>
                <h6 class="category">You can delete all information about yourself whenever you wish. This is
                    an extra service we are offering! Pay Attention: This button will only delete the information which
                    are currently stored. Any action you do later can cause a data collection about you again (writing a
                    post, ...). If you want to forbid our service to collect data, write us an
                    email with your username and we will ban it from our service. </h6>
                <br />
                <button class="btn btn-fill btn-primary btn-modern title" style="width: 25%; height: 25px"
                    onclick="openDeleteModal();">
                    Yes, delete everything
                </button>
                <br />
                <h6 class="category">Consider that a deletion can take some minutes</h6>
                <hr />
            </div>
        </div>

        <footer class="footer footer-info">
            <div class=" container ">
                <nav>
                    <ul>
                        <li>
                            <a href="https://www.creative-tim.com">
                                Creative Tim
                            </a>
                        </li>
                        <li>
                            <a href="http://presentation.creative-tim.com">
                                About Us
                            </a>
                        </li>
                        <li>
                            <a href="http://blog.creative-tim.com">
                                Blog
                            </a>
                        </li>
                    </ul>
                </nav>
                <div class="copyright" id="copyright">
                    &copy;
                    <script>
                        document.getElementById('copyright').appendChild(document.createTextNode(new Date().getFullYear()))
                    </script>, Designed by
                    <a href="https://www.invisionapp.com" target="_blank">Invision</a>. Coded by
                    <a href="https://www.creative-tim.com" target="_blank">Creative Tim</a>.
                </div>
            </div>
        </footer>
    </div>

    <!-- Delete Account Modal -->

    <div class="modal" tabindex="-1" role="dialog" id="delete-modal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body text-center">
                    <p>
                    <h5 class="modal-title">Are you Sure?</h5>
                    </p>
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-fill btn-secondary btn-modern"
                        data-dismiss="modal">Abort</button>
                    <button type="button" class="btn btn-fill btn-danger btn-modern" onclick="deleteAll();">Yes</button>
                </div>
            </div>
        </div>
    </div>


    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!--   Core JS Files   -->
    <script src="../assets/js/core/jquery.min.js" type="text/javascript"></script>
    <script src="../assets/js/core/popper.min.js" type="text/javascript"></script>
    <script src="../assets/js/core/bootstrap.min.js" type="text/javascript"></script>
    <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
    <script src="../assets/js/plugins/bootstrap-switch.js"></script>
    <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="../assets/js/plugins/nouislider.min.js" type="text/javascript"></script>
    <!--  Plugin for the DatePicker, full documentation here: https://github.com/uxsolutions/bootstrap-datepicker -->
    <script src="../assets/js/plugins/bootstrap-datepicker.js" type="text/javascript"></script>
    <!--  Google Maps Plugin    -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
    <!-- Control Center for Now Ui Kit: parallax effects, scripts for the example pages etc -->
    <script src="../assets/js/now-ui-kit.js?v=1.3.0" type="text/javascript"></script>

    <script src="discover/assets/js/hipster-cards.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/3.3.1/masonry.pkgd.min.js"></script>
    <script src="discover/assets/js/demo.js"></script>

    <script src="assets/js/config.js"></script>
    <script src="assets/js/cookie-manager.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@hivechain/hivejs/dist/hivejs.min.js"></script>

    <script>
        google.charts.load('current', { 'packages': ['corechart'] });

        // Global variables
        const urlParams = new URLSearchParams(window.location.search);
        var account = null;

        function makeid(length) {
            var result = '';
            var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            var charactersLength = characters.length;
            for (var i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            return result;
        }

        function openHiveSite(link) {
            standard = "https://hive.blog";

            var frontend = getCookie("front-end");
            if (frontend == "Peakd")
                standard = "https://peakd.com";
            if (frontend == "Leo Finance")
                standard = "https://leofinance.io";
            if (frontend == "Ecency")
                standard = "https://ecency.com";


            window.open(standard + link, '_blank');
        }

        function openDeleteModal() {
            $("#delete-modal").modal(true);
        }

        function getProfilerInfo() {
            // Get data
            $.ajax({
                url: API_ADDRESS + "/get-profiler?username=" + account["name"],
                contentType: 'application/json;charset=UTF-8',
                type: 'GET',
                success: function (response) {
                    if (response.status == "ok") {
                        // Set visibility
                        $("#account-info").attr("style", "");
                        $("#results-container").attr("style", "");
                        $("#account-exists-container").attr("style", "");
                        $("#page-header").attr("class", "page-header page-header-small");

                        if ("loading" in response) {
                            if (response.loading == false) {
                                $("#progress-bar-container").attr("style", "display: none");
                            } else {
                                // Set progress bar
                                $("#progress-bar-container").attr("style", "");

                                progress = 0;

                                if (response.loading != true) {
                                    // is object --> can calc progress
                                    max = response.loading.max;
                                    current = response.loading.current;
                                    progress = parseInt((current / max) * 100);
                                }

                                $("#progress-bar-width").attr("style", "width: " + progress.toString() + ";");
                                $("#progress-bar-value").text(progress.toString() + "%");

                                setTimeout(getProfilerInfo, 100);
                            }
                        }

                        d = response["categories"];
                        if (d) {
                            var data = [["Topic", "Value"]]
                            for (var i = 0; i < d.length; i++) {
                                // Push, when the label got more than 8%
                                if (d[i]["value"] > 0.05)
                                    data.push([d[i]["label"], d[i]["value"]]);
                            }

                            // Set chart options
                            var options = {
                                backgroundColor: "transparent",
                                enableInteractivity: false,
                                height: 600,
                                pieHole: 0.1
                            };

                            // Instantiate and draw our chart, passing in some options.
                            var chart = new google.visualization.PieChart(document.getElementById('profiler-pie-chart'));
                            chart.draw(google.visualization.arrayToDataTable(data), options);
                        }


                    } else {
                        // Account not found
                        $("#account-not-exists-container").attr("style", "");
                        $("#account-not-exists-name").text("@" + urlParams.get("u"));
                    }
                },
                error: function (error) {
                    console.log(error);
                }
            });

        }

        function deleteAll() {
            $.ajax({
                url: API_ADDRESS + "/delete-profiler?username=" + account["name"],
                contentType: 'application/json;charset=UTF-8',
                type: 'GET',
                success: function (response) {
                    if (response.status == "ok") {
                        alert("Delete " + parseInt(response.posts + response.accounts).toString() + " items!");
                        window.location.replace("/")
                    } else {
                        alert("Something went wrong!");
                    }
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

        $().ready(function () {
            if (urlParams.get("u") == null) {
                // No account
                window.location.replace("/");
                return;
            } else {
                // Check if username exists

                hivejs.api.getAccounts([urlParams.get("u")], function (err, result) {
                    $('#loading_animation').attr("style", "display: none");
                    if (result) {
                        if (result.length > 0) {
                            // exists
                            account = result[0];
                            getProfilerInfo();

                            // Set names and stuff like that
                            $("#account-link").text("@" + urlParams.get("u"));
                            $("#account-link").attr("href", "javascript: openHiveSite('/@" + urlParams.get("u") + "');");

                            // Set Author Images
                            if ("json_metadata" in account) {
                                var metadata = JSON.parse(account.json_metadata);
                                if ("profile" in metadata) {
                                    document.getElementsByName("author-img").forEach(img => {
                                        img.src = metadata["profile"]["profile_image"];
                                    });
                                }
                            }


                            return;
                        }
                    }

                    // account does not exist
                    $("#account-not-exists-container").attr("style", "");
                    $("#account-not-exists-name").text("@" + urlParams.get("u"));
                });
            }
        });

    </script>

</body>

</html>