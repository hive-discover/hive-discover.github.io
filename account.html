<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="assets/img/Logo/icon_only.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        Hive Discover
    </title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
        name='viewport' />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css"
        integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <!-- CSS Files -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/css/hover-effect.css" rel="stylesheet" />
    <link href="assets/css/loading-animator.css" rel="stylesheet" />
    <link href="assets/css/now-ui-kit.css?v=1.3.0" rel="stylesheet" />
</head>

<body class="login-page sidebar-collapse">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-primary fixed-top navbar-transparent " color-on-scroll="400">
        <div class="container">
            <div class="navbar-translate">
                <a class="navbar-brand" href="/" rel="tooltip">
                    Hive Discover
                </a>
                <button class="navbar-toggler navbar-toggler" type="button" data-toggle="collapse"
                    data-target="#navigation" aria-controls="navigation-index" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-bar top-bar"></span>
                    <span class="navbar-toggler-bar middle-bar"></span>
                    <span class="navbar-toggler-bar bottom-bar"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse justify-content-end" id="navigation"
                data-nav-image="../assets/img/blurred-image-1.jpg">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/feed.html">
                            <i class="fas fa-rss-square"></i>
                            <p class="d-lg-none d-xl-none">Feed</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/search.html">
                            <i class="fas fa-search"></i>
                            <p class="d-lg-none d-xl-none">Search</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" rel="tooltip" title="View on GitHub" data-placement="bottom"
                            href="https://github.com/Hive-Discover" target="_blank">
                            <i class="fab fa-github"></i>
                            <p class="d-lg-none d-xl-none">Github</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- End Navbar -->
    <div class="page-header clear-filter" filter-color="orange">
        <div class="page-header-image" style=""></div><!-- background-image:url(assets/img/bg8.jpg) -->
        <div class="content">
            <div class="container">
                <div class="row">
                    <div class="col-md-8 ml-auto mr-auto text-center">
                        <h2 class="title">Your Account</h2>
                        <h5 class="description">Our selfmade AI thinks that these 10 topics fit perfectly to you!</h5>
                        <h5 class="description">Does it fit? No - Then adjust it <a href="#adjust">here</a>!</h5>
                    </div>
                </div>
                <div id="chart_container" style="display: none;">

                    <div class="progress-container progress-danger" id="progress_bar_container" style="display: none;">
                        <span class="progress-badge">
                            Your profile is currently in work
                        </span>
                        <div class="progress">
                            <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60"
                                aria-valuemin="0" aria-valuemax="100" style="width: 50%;" id="progress_bar_width">
                                <span class="progress-value" id="progress_bar_value">27%</span>
                            </div>
                        </div>
                    </div>

                    <div id="chart_div" style="margin: auto;"></div>
                </div>
                <!-- Loading -->
                <div class="lds-roller" id="loading_animation">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
        </div>
    </div>


    <div class="section" id="adjust">
        <div class="container">
            <h2 class="title">Adjust your preferences</h2>
            <h5>Imagine you are reading a post. Which one do you thing is the most interesting? Just select the one,
                that fits the most to you! Anything you click, will optimize your profile. Be carefull</h5>
            <div class="row" style="margin: auto">
                <div class="card col-md-3 text-center clickable" style="margin: auto;" onclick="make_adjusting(1);">
                    <div class="card-body">
                        <h4 class="card-title">
                            <h6>Option 1</h6>
                        </h4>
                        <hr />
                        <h5 id="lbl_option_1"></h5>
                    </div>
                </div>
                <div class="card col-md-3 text-center clickable" style="margin: auto" onclick="make_adjusting(2);">
                    <div class="card-body">
                        <h4 class="card-title">
                            <h6>Option 2</h6>
                        </h4>
                        <hr />
                        <h5 id="lbl_option_2"></h5>
                    </div>
                </div>
                <div class="card col-md-3 text-center clickable" style="margin: auto" onclick="make_adjusting(3);">
                    <div class="card-body">
                        <h4 class="card-title">
                            <h6>Option 3</h6>
                        </h4>
                        <hr />
                        <h5 id="lbl_option_3"></h5>
                    </div>
                </div>



            </div>
            <hr />
            <div class="row" style="margin: auto">
                <a class="btn btn-danger col-md-3 text-center" id="btn_adjust_reload" style="margin: auto"
                    href="javascript: set_adjusting()">Nothing, next round</a>
            </div>
        </div>

        <br /> <br /> <br />
        <div class="container">
            <h2 class="title">Set Categories to Zero</h2>
            <h5>You can select categories and set them to Zero! Then they will be turned off for ever. Please be very
                carefull and do nothing wrong (Tip: Do only set a few to zero; only your hate categories)</h5>
            <div class="row" style="margin: auto">
                <div class="card col-md-5 text-center" style="margin: auto;">
                    <div class="card-body">
                        <div id="setzero_interact" style="display: none;">
                            <h4 class="card-title">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-secondary"
                                        id="setzero_drop_category">Category</button>
                                    <button type="button"
                                        class="btn btn-secondary dropdown-toggle dropdown-toggle-split"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <span class="sr-only">Toggle Dropdown</span>
                                    </button>
                                    <div class="dropdown-menu" style="overflow: scroll; max-height: 350px;"
                                        id="dropdown_list_categories">
                                        <!--      <a class="dropdown-item" href="javascript:setzero_dropdown('action');">Action</a>  -->

                                    </div>
                                </div>
                            </h4>
                            <hr />
                            <a href="javascript: OnClick_SetZero()" class="btn btn-info col-md-10">Set to Zero</a>
                        </div>
                        <h6 id="setzero_success" style="color: green; display: none">Successfully - Reload to see the
                            difference</h6>
                    </div>
                </div>
            </div>

        </div>

        <br /> <br /> <br />
        <div class="container">
            <h2 class="title">Delete my Profile</h2>
            <h5>If you want, you can order to delete your profile. You can use it when ever you done a mistake and want
                to recalculate your profile. Just delete your profile and restart. Also, all Cookies and Preferences
                will be removed</h5>
            <div class="row" style="margin: auto">
                <div class="card col-md-5 text-center" style="margin: auto;">
                    <div class="card-body">
                        <h4 class="card-title">
                            <h6>Are you sure?</h6>
                        </h4>
                        <hr />
                        <a href="javascript: OnClick_DeleteProfile()" class="btn btn-info col-md-10">Yes, delete my
                            profile</a>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <footer class="footer">
        <div class=" container ">
            <nav>
                <ul>
                    <li>
                        <a href="https://hive.blog/@action-chain" target="_blank">
                            Action Chain
                        </a>
                    </li>
                    <li>
                        <a href="/about-us.html">
                            About Us
                        </a>
                    </li>
                    <li>
                        <a href="/de_impressum.html">
                            Impressum
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="copyright" id="copyright">
                &copy;
                <script>
                    document.getElementById('copyright').appendChild(document.createTextNode(new Date().getFullYear()))
                </script>, Coded by
                <a href="https://hive.blog/@action-chain" target="_blank">Action-Chain</a>.
            </div>
        </div>
    </footer>


    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"
        integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@hivechain/hivejs/dist/hivejs.min.js"></script>

    <script src="assets/js/config.js" type="text/javascript"></script>
    <script src="assets/js/cookie-manager.js" type="text/javascript"></script>
    <!--   Core JS Files   -->
    <script src="assets/js/core/jquery.min.js" type="text/javascript"></script>
    <script src="assets/js/core/popper.min.js" type="text/javascript"></script>
    <script src="assets/js/core/bootstrap.min.js" type="text/javascript"></script>
    <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
    <script src="assets/js/plugins/bootstrap-switch.js"></script>
    <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="assets/js/plugins/nouislider.min.js" type="text/javascript"></script>
    <!--  Plugin for the DatePicker, full documentation here: https://github.com/uxsolutions/bootstrap-datepicker -->
    <script src="assets/js/plugins/bootstrap-datepicker.js" type="text/javascript"></script>
    <!-- Control Center for Now Ui Kit: parallax effects, scripts for the example pages etc -->
    <script src="assets/js/now-ui-kit.js" type="text/javascript"></script>

    <script type="text/javascript">

        // Username checking
        var username;
        if (checkCookie("username") == false)
            window.location.replace("index.html");
        else {
            username = getCookie("username");

            // Update profiler
            $.ajax({
                url: SERVER_DOMAIN + "/ping",
                data: JSON.stringify({ "username": username }),
                contentType: 'application/json;charset=UTF-8',
                type: 'POST',
                success: function (response) {
                    if (response["status"] != "succes") {
                        console.log(response);
                        alert("Something went wrong!");
                    }
                },
                error: function (error) {
                    console.log(error);
                    alert("Something went wrong!");
                }
            });
        }

        // Chart data loading
        google.charts.load('current', { 'packages': ['corechart'] });
        google.charts.setOnLoadCallback(get_data);

        // Categorize
        var set_to_zero_selected = "";
        var categories = [];
        window.addEventListener("load", load_categories);

        function OnClick_DeleteProfile() {
            $.ajax({
                url: SERVER_DOMAIN + "/delete_user",
                data: JSON.stringify({ "username": username }),
                contentType: 'application/json;charset=UTF-8',
                type: 'POST',
                success: function (response) {
                    if (response["status"] != "succes") {
                        console.log(response);
                        alert("Something went wrong!");
                        return;
                    }

                    window.location.replace("index.html");

                },
                error: function (error) {
                    console.log(error);
                    alert("Something went wrong!");
                }
            });
            deleteAllCookies();
        }

        function setzero_dropdown(value) {
            document.getElementById('setzero_drop_category').innerHTML = value;
            set_to_zero_selected = value;
        }

        function OnClick_SetZero() {
            if (set_to_zero_selected == "") {
                alert("Please select a category.");
                return;
            }

            document.getElementById("setzero_interact").style = "display: none;";

            $.ajax({
                url: SERVER_DOMAIN + "/set_to_zero",
                data: JSON.stringify({ "username": username, "cat": set_to_zero_selected }),
                contentType: 'application/json;charset=UTF-8',
                type: 'POST',
                success: function (response) {
                    if (response["status"] != "succes") {
                        console.log(response);
                        alert("Something went wrong!");
                        return;
                    }

                    document.getElementById("setzero_interact").style = "";
                    document.getElementById("setzero_success").style = "color: green;";
                },
                error: function (error) {
                    console.log(error);
                    alert("Something went wrong!");

                    document.getElementById("setzero_interact").style = "";
                    document.getElementById("setzero_success").style = "color: green;";
                }
            });
        }

        function load_categories() {
            $.ajax({
                url: SERVER_DOMAIN + "/get_categories",
                data: JSON.stringify({}),
                contentType: 'application/json;charset=UTF-8',
                type: 'POST',
                success: function (response) {
                    if (response["status"] != "succes") {
                        console.log(response);
                        alert("Something went wrong!");
                        return;
                    }

                    categories = response["list"];
                    set_adjusting();

                    //set categories for zero
                    for (var i = 0; i < categories.length; i++) {
                        var item = document.createElement('a');
                        item.className = "dropdown-item";
                        item.href = "javascript:setzero_dropdown('" + categories[i] + "');";
                        item.innerHTML = categories[i];

                        document.getElementById("dropdown_list_categories").appendChild(item);
                    }

                    document.getElementById("setzero_interact").style = "";
                },
                error: function (error) {
                    console.log(error);
                    alert("Something went wrong!");
                }
            });
        }

        function get_data() {
            $.ajax({
                url: SERVER_DOMAIN + "/get_user_profile",
                data: JSON.stringify({ "username": username }),
                contentType: 'application/json;charset=UTF-8',
                type: 'POST',
                success: function (response) {
                    if (response["status"] != "succes") {
                        console.log(response);
                        alert("Something went wrong!");
                        return;
                    }

                    if (response["finished"] == false) {
                        //Show it
                        document.getElementById("progress_bar_container").style = "";
                        document.getElementById("progress_bar_width").style = "width: " + response["data_length"].toString() + "%;";
                        document.getElementById("progress_bar_value").innerText = response["data_length"].toString() + "%";

                        //Reload later
                        setTimeout(get_data, 1000);
                    } else {
                        document.getElementById("progress_bar_container").style = "display: none";
                    }

                    // process data
                    var data = [["Topic", "Value"]]
                    d = response["top_cats"]
                    for (var i = 0; i < d.length; i++) {
                        data.push([d[i]["label"], Math.floor(d[i]["value"] * 100000)]);
                    }

                    // Set chart options
                    var options = {
                        backgroundColor: "transparent",
                        enableInteractivity: false,
                        height: 600,
                        pieHole: 0.1
                    };

                    document.getElementById("loading_animation").style = "display: none";
                    document.getElementById("chart_container").style = "";

                    // Instantiate and draw our chart, passing in some options.
                    var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
                    chart.draw(google.visualization.arrayToDataTable(data), options);
                },
                error: function (error) {
                    console.log(error);
                    alert("Something went wrong!");
                }
            });

        }

        function get_random_categories(amount) {
            var rnd = []

            for (var i = 0; i < amount; i++) {
                var element = " " + categories[Math.floor(Math.random() * categories.length)];
                rnd.push(element);
            }

            return rnd;
        }

        function set_adjusting() {

            document.getElementById("btn_adjust_reload").disabled = true;
            // Option 1
            document.getElementById("lbl_option_1").innerHTML = get_random_categories(Math.floor(Math.random() * 5) + 2).toString();

            // Option 2
            document.getElementById("lbl_option_2").innerHTML = get_random_categories(Math.floor(Math.random() * 5) + 2).toString();

            // Option 3
            document.getElementById("lbl_option_3").innerHTML = get_random_categories(Math.floor(Math.random() * 5) + 2).toString();

            document.getElementById("btn_adjust_reload").disabled = false;
        }

        function make_adjusting(index) {
            var cats = document.getElementById("lbl_option_" + index).innerHTML.replace(' ', '').split(", ");

            // Send it --> Response does not matter
            $.ajax({
                url: SERVER_DOMAIN + "/adjust",
                data: JSON.stringify({ "username": username, "cats": cats.toString() }),
                contentType: 'application/json;charset=UTF-8',
                type: 'POST',
                success: function (response) {
                    if (response["status"] != "succes") {
                        console.log(response);
                        alert("Something went wrong!");
                    }
                },
                error: function (error) {
                    console.log(error);
                    alert("Something went wrong!");
                }
            });

            // make new ones
            set_adjusting();
        }

        function OpenInNewTab(url) {
            var win = window.open(url, '_blank');
            win.focus();
        }
    </script>
</body>

</html>