<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
        <link rel="icon" type="image/png" href="assets/img/Logo/icon_only.png">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <title>
            Hive Discover - Statistics
        </title>
        <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
            name='viewport' />
        <!--     Fonts and icons     -->
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css"
            integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
        <!-- CSS Files style="width: 20rem;" -->
        <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="assets/css/loading-animator.css" rel="stylesheet" />
        <link href="assets/css/now-ui-kit.css?v=1.3.0" rel="stylesheet" />
    </head>

    <body>
    
<div class="text-center">
     <br />
    <p>
        Statistics of Hive-Discover
    </p>
</div>

        <hr />

        <div class="row">
            <div class="card col-md-2 text-center" style="margin: auto">
                <div class="card-body">
                    <h4 class="card-title">
                        <h6>Amount of Accounts</h6>
                    </h4>
                    <hr />
                    <h5 id="lbl_amount_Accounts">50</h5>
                </div>
            </div>
            <div class="card col-md-2 text-center" style="margin: auto">
                <div class="card-body">
                    <h4 class="card-title">
                        <h6>Amount of Posts</h6>
                    </h4>
                    <hr />
                    <h5 id="lbl_amount_Posts">500k</h5>
                </div>
            </div>
        </div>

        <hr />

        <div class="row">
            <div class="card col-md-5" style="margin: auto">
                <div class="card-body">
                    <p class="card-text">
                    <h6 class="text-center">Total tasks currently running</h6>
                    </p>
                </div>
                <div class="card-img-top" id="tasks_running_chart"></div>
            </div>
    
            <div class="card col-md-3" style="margin: auto">
                <div class="card-body">
                    <p class="card-text">
                    <h6 class="text-center">Requests</h6>
                    </p>
                </div>
                <div class="card-img-top" id="requests_chart"></div>
            </div>
            <div class="card col-md-3" style="margin: auto">
                <div class="card-body">
                    <p class="card-text">
                    <h6 class="text-center">Connections</h6>
                    </p>
                </div>
                <div class="card-img-top" id="connections_chart"></div>
            </div>
        </div>
    </body>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script src="assets/js/config.js" type="text/javascript"></script>
    <script src="assets/js/cookie-manager.js" type="text/javascript"></script>
     <!--   Core JS Files   -->
     <script src="assets/js/core/jquery.min.js" type="text/javascript"></script>
     <script src="assets/js/core/popper.min.js" type="text/javascript"></script>
     <script src="assets/js/core/bootstrap.min.js" type="text/javascript"></script>
     <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
     <script src="assets/js/plugins/bootstrap-switch.js"></script>
     <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
     <script src="assets/js/plugins/nouislider.min.js" type="text/javascript"></script>
     <!--  Plugin for the DatePicker, full documentation here: https://github.com/uxsolutions/bootstrap-datepicker -->
     <script src="assets/js/plugins/bootstrap-datepicker.js" type="text/javascript"></script>
     <!-- Control Center for Now Ui Kit: parallax effects, scripts for the example pages etc -->
     <script src="assets/js/now-ui-kit.js" type="text/javascript"></script>
    
    <script type="text/javascript">
    
        MAX_DATA_LEN = 20;
        tasks_running_data = [];
        requests_data = [];
        connections_data = [];


        google.charts.load('current', {'packages':['corechart', 'line']});
        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(get_data);

        function  get_data(){
            $.ajax({
                url: SERVER_DOMAIN + "/get_analytics",
                data: JSON.stringify({}),
                contentType: 'application/json;charset=UTF-8',
                type: 'POST',
                success: function(response){
                    if(response["status"] != "succes"){
                        console.log(response);
                        alert("Something went wrong!");
                        return;
                    }

                    var currentdate = new Date();
                    var timestamp = currentdate.getHours() + ":" + currentdate.getMinutes() + ":" + currentdate.getSeconds();
                    
                    tasks_running_data.push([timestamp, response["tasks_running"]]);
                    while(tasks_running_data.length >= MAX_DATA_LEN)
                        tasks_running_data.shift()

                    requests_data.push([timestamp, response["requests"]]);
                    while(requests_data.length >= MAX_DATA_LEN)
                        requests_data.shift()

                    connections_data.push([timestamp, response["connections"]]);
                    while(connections_data.length >= MAX_DATA_LEN)
                        connections_data.shift()

                    setdata();
                    setTimeout(get_data, 900);
                },
                error: function(error){
                    console.log(error);
                    alert("Something went wrong!");
                }
            });
        }

        function setdata(){
            var options = {
                title: '',
                curveType: 'function',
                legend: { position: 'none' }
              };

            // Tasks running
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Time');
            data.addColumn('number', 'Running');
            for (var i = 0; i < tasks_running_data.length; i++) {
                data.addRows([tasks_running_data[i]]);
            }
            var chart = new google.charts.Line(document.getElementById('tasks_running_chart'));
            chart.draw(data, options); 
            
            // Requests
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Time');
            data.addColumn('number', 'Requests');
            for (var i = 0; i < requests_data.length; i++) {
                data.addRows([requests_data[i]]);
            }
            var chart = new google.charts.Line(document.getElementById('requests_chart'));
            chart.draw(data, options); 

            // Connections
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Time');
            data.addColumn('number', 'Connections');
            for (var i = 0; i < connections_data.length; i++) {
                data.addRows([connections_data[i]]);
            }
            var chart = new google.charts.Line(document.getElementById('connections_chart'));
            chart.draw(data, options); 
        }

    </script>
</html>